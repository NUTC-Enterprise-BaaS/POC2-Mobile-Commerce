!function(){var moduleFactory=function($){var module=this,exports=function(){var _backspace="",_space=" ",_nbsp="Â ",_newline="\n",_typeAttr="data-type",_valueAttr="data-value",KEYCODE={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,ENTER:13,ESCAPE:27,LEFT:37,RIGHT:39,SPACE:32,TAB:9,UP:38};$.fn.caret=function(start,end){if(0!=this.length){if("number"==typeof start)return end="number"==typeof end?end:start,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(start,end);else if(this.createTextRange){var range=this.createTextRange();
range.collapse(!0),range.moveEnd("character",end),range.moveStart("character",start);try{range.select()}catch(ex){}}});if(this[0].setSelectionRange)start=this[0].selectionStart,end=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();start=0-range.duplicate().moveStart("character",-1e5),end=start+range.text.length}return{start:start,end:end}}};var Marker=function(options){$.extend(this,options)};$.extend(Marker.prototype,{val:function(str){var marker=this;
return void 0===str?marker.text.nodeValue:(marker.text.nodeValue=str,marker.end=marker.start+(marker.length=str.length),marker)},nextSibling:function(node){for(var next=node.nextSibling;next&&1===next.nodeType&&next.hasAttribute("data-ignore");)next=next.nextSibling;return next},insert:function(str,start,end){var marker=this,block=marker.block,text=marker.text,parent=marker.parent,br=marker.br,val=marker.val(),length=marker.length,newline=str==_newline,space=str==_space,backspace=str==_backspace,trigger=marker.trigger||{},finalized=(trigger.finalize,marker.finalized),trailingSpace=32==val.charCodeAt(start-1),allowSpace=trigger.allowSpace||marker.allowSpace,spawnSpace=space&&(!allowSpace||allowSpace&&trailingSpace);
if(void 0===start&&(start=length),void 0===end&&(end=start),block&&allowSpace&&trailingSpace&&!finalized){if(space){var $textarea=$(marker.textarea),wholeText=$textarea.val(),pos=$textarea.caret().end-1,offset=marker.start+start;$textarea.val(wholeText.substring(0,offset)+wholeText.slice(offset+1)).caret(pos)}return marker.toTextMarker(),space?($(parent).trigger("markerInsert",[marker,nodes,str,start,end]),marker):marker.insert(str,start,end)}if(block&&end==length&&!backspace&&(spawnSpace||newline||br||finalized)){var spawn=marker.spawn().insert(str,0);
return $(parent).trigger("markerExit",[marker,nodes,spawn,str,start,end]),spawn}if(block&&0===marker.index&&0===end&&1===str.length){var textnode=document.createTextNode(str);parent.insertBefore(textnode,block);var newMarker=new Marker({index:0,start:0,end:str.length,text:textnode,parent:parent,textarea:marker.textarea,allowSpace:!0});return $(parent).trigger("markerInsert",[newMarker,nodes,str,start,end]),newMarker}var next=block?block.nextSibling:text.nextSibling,prefix=val.substring(0,start),suffix=val.slice(end),chunks=str.replace(/  /g," "+_nbsp).split(_newline),nodes=[],node=block||text,i=chunks.length;
for(chunks[0]=prefix+chunks[0],chunks[i-1]+=suffix;--i;){var node=document.createTextNode(chunks[i]),br=document.createElement("BR");nodes.push(parent.insertBefore(node,next)),nodes.push(parent.insertBefore(br,node)),next=br}return marker.val(chunks[i]),$(parent).trigger("markerInsert",[marker,nodes,str,start,end]),marker},remove:function(){var marker=this,parent=marker.parent,block=marker.block,text=marker.text;return block&&$(block).trigger("triggerDestroy",[marker]),parent.removeChild(block||text),marker.removed=!0,$(parent).trigger("markerRemove",[marker]),marker
},toTextMarker:function(){var marker=this,block=marker.block,parent=marker.parent;if(!block)return marker;var old=marker.clone();return block&&$(block).trigger("triggerDestroy",[marker]),parent.insertBefore(marker.text,block.nextSibling),parent.removeChild(block),delete marker.block,delete marker.trigger,$(marker.parent).trigger("markerConvert",[marker,old,"text"]),marker},toBlockMarker:function(){var marker=this;if(!marker.block){var old=marker.clone(),parent=marker.parent,block=marker.block=document.createElement("SPAN"),text=marker.text;
return parent.insertBefore(block,text.nextSibling),block.appendChild(text),$(block).data("marker",{}),$(marker.parent).trigger("markerConvert",[marker,old,"block"]),marker}},spawn:function(start,end){var marker=this,text=marker.text,parent=marker.parent,block=marker.block,next=block?block.nextSibling:text.nextSibling;void 0===start&&(start=end=marker.length),end<marker.length&&(next=parent.insertBefore(text.splitText(end),next)),text=parent.insertBefore(text.splitText(start),next);var spawn=new Marker({index:marker.index+1,start:start=marker.start+start,end:end=marker.start+end,length:end-start,text:text,parent:parent,textarea:marker.textarea,before:marker,after:marker.after,br:!1,allowSpace:!0,finalized:!1});
return marker.end=start,marker.length=marker.end-marker.start,marker.after=spawn,spawn},clone:function(){return new Marker($.pick(this,"index,start,end,length,text,parent,textarea,before,after,br,allowSpace,trigger,value,finalized".split(",")))},finalize:function(value){var marker=this,block=marker.block;if(block){var data=$(block).data("marker");data.value=value,data.finalized=!0,$.extend(marker,data)}}}),$.Controller("Mentions",{pluginName:"mentions",hostname:"mentions",defaultOptions:{cssCloneProps:["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust"],triggers:{},inspector:!1,"{textarea}":"[data-mentions-textarea]","{overlay}":"[data-mentions-overlay]","{block}":"[data-mentions-overlay] > span"}},function(self){return{init:function(){self._overlay=self.overlay()[0],self._textarea=self.textarea()[0],setTimeout(function(){self.cloneLayout()
},15),self.options.inspector&&self.inspect(),self.addPlugin("autocomplete"),self.initialCaret=self.textarea().data("initial")||0},inspect:function(){self.inspector=self.addPlugin("inspector"),self.inspector.showInspector()},setLayout:function(){self.normalize()},cloneLayout:function(){for(var $overlay=self.overlay(),overlay=$overlay.detach()[0],textarea=self.textarea(),props=self.options.cssCloneProps,i=0;prop=props[i++];)overlay.style[prop]=textarea.css(prop);overlay.style.opacity=1,$overlay.insertBefore(textarea),self.setLayout()
},reset:function(){var overlay=self.overlay(),overlayDefault=overlay.data("default");void 0!==overlayDefault?overlay.html($("<div>").html(overlayDefault).html()):overlay.empty();var textarea=self.textarea(),textareaDefault=textarea.data("default");textarea.val(void 0!==textareaDefault?$("<div>").html(textareaDefault).text():""),self.caretBefore=self.caretAfter={start:0,end:0},self.previousMarker=null,self.normalize(),self.initialFocus=!0,self.trigger("triggerClear")},getTrigger:function(key){var triggers=self.options.triggers;
if(triggers.hasOwnProperty(key)){var trigger=triggers[key];return trigger.key=key,trigger}},getTriggerFromType:function(type){var found,triggers=self.options.triggers;return $.each(triggers,function(key,trigger){return trigger.type===type?(found=trigger,!1):void 0}),found},getStopIndex:function(str,stop){for(var i=stop.length,idx=str.length;i--;){var chr=stop.substr(i,1),pos=str.indexOf(chr);idx=0>pos?idx:Math.min(idx,pos)}return idx},getMarkers:function(callback){var node,textarea=self._textarea,overlay=self._overlay,nodes=$.makeArray(overlay.childNodes),i=0,start=0,before=null,skip=!1,results=[],iterator=function(marker){var ret;
return callback&&(ret=callback.apply(marker,[marker])),null!==ret&&ret!==!1&&results.push(void 0!==ret?ret:marker),ret};for($.remove(nodes,function(node){return 1===node.nodeType&&node.hasAttribute("data-ignore")});node=nodes[i++];){var text,end,length,nodeType=node.nodeType,nodeName=node.nodeName,block=null,br=!1,allowSpace=!1;if(3==nodeType)text=node,allowSpace=!0;else if((block=node)&&"BR"==nodeName)text=document.createTextNode(_newline),br=!0;else if(1!==nodeType||"SPAN"!==nodeName||!(text=node.childNodes[0])||3!==text.nodeType){overlay.removeChild(node);
continue}var props={index:i-1,start:start,end:end=start+(length=text.length),length:length,text:text,block:block,parent:overlay,textarea:textarea,before:before,br:br,allowSpace:allowSpace,finalized:!1};if(block){var $node=$(node),data=$node.data("marker");if(data||(data={})&&$node.data("marker",data),node.hasAttribute(_typeAttr)){var type=$node.attr(_typeAttr),trigger=self.getTriggerFromType(type);trigger&&(data.trigger=trigger),$node.removeAttr(_typeAttr)}node.hasAttribute(_valueAttr)&&(data.value=$node.attr(_valueAttr),data.finalized=!0,$node.removeAttr(_valueAttr)),$.extend(props,data)
}var marker=new Marker(props);if(i>1&&(before.after=marker,skip=iterator(before)===!1))break;start=end,before=marker}return skip||iterator(before),results},getMarkerAt:function(pos){if(void 0!==pos){var marker;return self.getMarkers(function(){return pos>=this.start&&pos<=this.end?(marker=this,!1):void 0}),marker}},getMarkersBetween:function(start,end){return void 0!==start?self.getMarkers(function(){return this.start>end?!1:this.end<start?null:this}):void 0},toArray:function(stringify,asc){var results=self.getMarkers(function(){var marker=this;
if(!marker.block||marker.br)return null;if(!marker.trigger){var wholeText=marker.text.nodeValue,key=wholeText.slice(0,1),trigger=self.getTrigger(key);if(!trigger)return null;marker.trigger=trigger,marker.value=wholeText.slice(1)}var data={start:marker.start,length:marker.length,type:marker.trigger.type,value:marker.value};return stringify?JSON.stringify(data):data});return asc?results:results.reverse()},insert:function(str,start,end){var marker,offset;if(start===end||void 0===end)marker=self.getMarkerAt(start),offset=marker.start,marker.insert(str,start-offset,end-offset);
else{var markers=self.getMarkersBetween(start,end),length=markers.length;if(1>length)return;if(1==length)marker=markers[0],offset=marker.start,marker.insert(str,start-offset,end-offset);else{var i=length-1,marker=markers[i];for(marker.block&&end>marker.start&&marker.toTextMarker(),end-marker.start>0&&marker.insert("",0,end-marker.start);(marker=markers[--i])&&i>0;)marker.remove();marker.block&&0===marker.index&&0===start&&marker.toTextMarker(),marker.insert(str,start-marker.start,marker.length),0===start&&marker.br&&marker.remove()
}}return self.normalize(),marker},textareaInsert:function(str,start,end){var textarea=self._textarea,val=textarea.value;return textarea.value=val.substring(0,start)+str+val.slice(end)},normalize:function(){var overlay=self._overlay,textarea=self._textarea;overlay.normalize();var first=overlay.firstChild,last=overlay.lastChild,textNode=document.createTextNode("");last&&"BR"!==last.nodeName||overlay.appendChild(textNode),last&&last==first&&1===last.nodeType&&last.hasAttribute("data-ignore")&&overlay.insertBefore(textNode,last),overlay.style.height="auto",overlay.style.height=textarea.scrollHeight+"px",textarea.scrollTop=0,self.lengthBefore=textarea.value.length
},lengthBefore:0,caretBefore:{start:0,end:0},caretAfter:{start:0,end:0},skipKeydown:!1,previousMarker:null,initialFocus:!0,"{textarea} focus":function(){self.initialFocus&&self.textarea().caret(self.initialCaret||0)},"{textarea} keydown":function(textarea,event){if(self.initialFocus=!1,!self.skipKeydown){{self.caretBefore=textarea.caret()}8===event.keyCode&&$.IE<10&&self.overlay().css("opacity",0),self.skipKeydown=!0}},"{textarea} keypress":function(textarea,event){self.caretBefore=textarea.caret(),8===event.keyCode
},"{textarea} input":function(textarea){self.reflect(),textarea.val().length<1&&self.reset()},"{textarea} keyup":function(textarea,event){if(self.skipKeydown=!1,8===event.keyCode&&$.IE<10){var caretBefore=self.caretBefore,caretAfter=self.caretAfter=self.textarea().caret();self.insert("",caretAfter.end,caretBefore.end),self.caretBefore=caretAfter,self.overlay().css("opacity",1)}},reflect:function(){var textarea=self._textarea,wholeText=textarea.value,caretBefore=self.caretBefore,caretAfter=self.caretAfter=$(textarea).caret(),operaCandidateWindow=$.browser.opera&&caretAfter.end>caretAfter.start,marker=self.getMarkerAt(caretBefore.start),diff=self.lengthBefore-wholeText.length,replace=!1;
if(operaCandidateWindow&&caretBefore.start!==caretBefore.end&&(caretBefore.end+=diff),marker){var previousMarker=self.previousMarker,block=marker.block;if(previousMarker){var previousBlock=previousMarker.block,finalize=(previousMarker.trigger||{}).finalize;if(previousBlock&&finalize&&!previousMarker.finalized&&previousBlock!==block)try{previousMarker.toTextMarker()}catch(e){self.previousMarker=null}}if(!marker.br&&(0===diff||caretAfter.end<caretBefore.start))var textStart=marker.start,textEnd=marker.end-diff,rangeStart=caretAfter.end,rangeEnd=caretBefore.start,replace=textStart!==textEnd;
else var rangeStart=textStart=Math.min(caretBefore.start,caretAfter.start),rangeEnd=caretBefore.end,textEnd=caretAfter.end;var text=wholeText.substring(textStart,textEnd);replace?(marker.val()!==text&&marker.finalized&&marker.toTextMarker(),marker.val(text),self.overlay().trigger("markerInsert",marker,[],text,textStart,textEnd),self.normalize()):self.insert(text,rangeStart,rangeEnd),operaCandidateWindow&&(caretAfter.start=caretAfter.end),self.caretBefore=self.caretAfter}},"{overlay} markerInsert":function(overlay,event,marker,nodes,str,start,end){var trigger,text=marker.text,wholeText=text.nodeValue;
if(self.previousMarker=null,trigger=self.getTrigger(str)){var charBefore=wholeText.charCodeAt(start-1),brBefore=marker.before&&marker.before.br;if(0===marker.index||32===charBefore||brBefore){var remainingText=wholeText.slice(start),content=remainingText.slice(1);end=trigger.wrap&&remainingText.length>1?self.getStopIndex(content,trigger.stop)+start+1:start+1;var spawn=marker.spawn(start,end).toBlockMarker(),content=spawn.val().slice(1),data=$(spawn.block).data("marker");data.value=content,data.trigger=trigger,self.previousMarker=spawn,self.trigger("triggerCreate",[spawn,trigger,content])
}}if(marker.block&&!marker.br)if(marker.finalized){var length=marker.length;length-1>end&&marker.toTextMarker()}else{var key=wholeText.slice(0,1),trigger=self.getTrigger(key);if(!trigger)return;var content=wholeText.slice(1),start=self.getStopIndex(content,trigger.stop)+1,end=wholeText.length,spawn=!1;end>start&&(spawn=marker.spawn(start,end)),content=marker.val().slice(1);var data=$(marker.block).data("marker");data.value=content,data.trigger=trigger,self.previousMarker=marker,self.trigger("triggerChange",[marker,spawn,trigger,content])
}},"{overlay} markerExit":function(overlay,event,marker,nodes,spawn){var trigger=marker.trigger;if(trigger){var allowSpace=trigger.allowSpace||marker.allowSpace,content=marker.val();allowSpace||marker.val()!==trigger.key||marker.toTextMarker(),self.trigger("triggerExit",[marker,spawn,trigger,content])}}}}),$.template("mentions/menu",'<div class="mentions-autocomplete" data-mentions-autocomplete><b><b></b></b><div class="mentions-autocomplete-inner" data-mentions-autocomplete-viewport><div class="mentions-autocomplete-loading" data-mentions-autocomplete-loading data-mentions-autocomplete-close></div><div class="mentions-autocomplete-empty" data-mentions-autocomplete-empty></div><div class="mentions-autocomplete-search" data-mentions-autocomplete-search></div><ul class="mentions-menu" data-mentions-menu></ul></div></div>'),$.template("mentions/menuItem",'<li class="mentions-menuItem" data-mentions-menuItem>[%== html %]</li>'),$.template("mentions/loadingHint",'<i class="mentions-autocomplete-loading-indicator"></i>'),$.template("mentions/searchHint",'<span class="mentions-autocomplete-search-hint">Type a keyword to begin.</span>'),$.template("mentions/emptyHint",'<span class="mentions-autocomplete-empty-text">No items found.</span>'),$.Controller("Mentions.Autocomplete",{defaultOptions:{view:{menu:"mentions/menu",menuItem:"mentions/menuItem",searchHint:"mentions/searchHint",loadingHint:"mentions/loadingHint",emptyHint:"mentions/emptyHint"},id:"",component:"",modifier:"",shadow:!1,sticky:!1,animation:!1,query:{data:null,cache:!0,minLength:1,limit:10,highlight:!0,caseSensitive:!1,exclusive:!1,searchHint:!1,loadingHint:!1,emptyHint:!1},position:{my:"left top",at:"left bottom",collision:"none"},size:{width:"auto",height:"auto"},"{menu}":"[data-mentions-menu]","{menuItem}":"[data-mentions-menuItem]","{viewport}":"[data-mentions-autocomplete-viewport]","{loadingHint}":"[data-mentions-autocomplete-loading]","{emptyHint}":"[data-mentions-autocomplete-empty]","{searchHint}":"[data-mentions-autocomplete-search]","{closeButton}":"[data-mentions-autocomplete-close]"}},function(self,opts,base){return{init:function(){setTimeout(function(){if(self.element.data(self.Class.fullName)){var mentions=self.mentions;
self.uid=$.uid(),mentions.autocomplete=self,mentions.pluginInstances.autocomplete=self,opts.position.of||(opts.position.of=self.mentions.element),self.defaultSearchHint=self.view.searchHint().toHTML(),self.defaultEmptyHint=self.view.emptyHint().toHTML(),self.defaultLoadingHint=self.view.loadingHint().toHTML(),self.element.detach()}else{self.destroy();{self.view.menu().attr("id",opts.id).addClass(opts.component).addClass(opts.modifier).addClass(opts.shadow?"has-shadow":"").addClass(opts.animation?"has-animation":"").addClass(opts.sticky?"is-sticky":"").appendTo("body").data(self.Class.fullName,!0).addController(self.Class,opts)
}}},50)},setLayout:function(){if(!self.hidden){var options=self.options,size=options.size,width=self.mentions.element.outerWidth(),height="auto";$.isFunction(size.width)&&(width=size.width(width)),$.isFunction(size.height)&&(height=size.height(height)),self.element.css({opacity:1,width:width}).position(self.options.position),setTimeout(function(){self.viewport().addClass("active")},1)}},"{window} resize":$.debounce(function(){self.element.css("opacity",0),self.setLayout()},250),"{window} scroll":$.debounce(function(){self.element.css("opacity",0),self.setLayout()
},250),"{window} dialogTransitionStart":function(){self.hidden=!0,self.element.css("opacity",0)},"{window} dialogTransitionEnd":function(){self.hidden=!1,self.setLayout()},currentMarker:null,"{mentions} triggerCreate":function(el,event,marker,trigger,content){self.populate(marker,trigger,content),self.currentMarker=marker},"{mentions} triggerChange":function(el,event,marker,spawn,trigger,content){self.populate(marker,trigger,content),self.currentMarker=marker},"{mentions} triggerExit":function(){var query=self.activeQuery;
query&&(query.aborted=!0),self.hide()},"{mentions.block} triggerDestroy":function(){self.hide()},"{mentions} triggerClear":function(){self.hide()},hidden:!0,show:function(duration){clearTimeout(self.sleep),self.element.appendTo("body").show(),self.hidden=!1,self.viewport().removeClass("active"),self.setLayout();var doc=$(document),hideOnClick="click.mentions."+self.uid;doc.off(hideOnClick).on(hideOnClick,function(event){var targets=$(event.target).parents().andSelf();targets.filter(base).length>0||(doc.off(hideOnClick),self.hide())
}),duration&&(self.sleep=setTimeout(function(){self.hide()},duration))},hide:function(){self.element.hide();var menuItem=self.menuItem(),activeMenuItem=menuItem.filter(".active");activeMenuItem.length>0&&(self.lastItem={keyword:"",item:activeMenuItem.data("item")}),self.viewport().removeClass("active"),menuItem.removeClass("active"),self.render.reset(),self.hidden=!0,clearTimeout(self.sleep),self.sleep=setTimeout(function(){self.element.detach()},3e3)},query:function(options){if(options){var query=$.extend({},self.options.query,$.isPlainObject(options)?options:{data:options}),data=query.data;
if(data){if($.isUrl(data)){var url=data;query.lookup=function(){return $.ajax(url+query.keyword)}}if($.isFunction(data)){var func=data;query.lookup=function(){return func.call(self,query.keyword)}}if($.isArray(data)){var dataset=data;query.lookup=function(){var task=$.Deferred(),keyword=query.keyword.toLowerCase();return setTimeout(function(){var result=$.grep(dataset,function(item){return item.title.toLowerCase().indexOf(keyword)>-1});task.resolve(result)},0),task}}return query}}},tasks:{},delayTask:null,activeQuery:null,populate:function(marker,trigger,keyword){var query=self.activeQuery;
query&&(query.aborted=!0);var query=self.query(trigger.query);if(query){self.activeQuery=query,query.keyword=keyword,query.trigger=trigger,query.marker=marker,self.trigger("queryPrepare",[query]);var keyword=query.keyword;if(""===keyword||keyword.length<query.minLength){var searchHint=query.searchHint;return void(searchHint?(self.searchHint().html($.isString(searchHint)?searchHint:self.defaultSearchHint),self.element.addClass("search"),self.show()):self.hide())}var id=query.id=trigger.key+"|"+query.caseSensitive?keyword:keyword.toLowerCase(),tasks=self.tasks,task=query.task=tasks[id],newTask=!$.isDeferred(task)||!query.cache,runTask=function(){var event=self.trigger("queryBeforeStart",[query]);
event.isDefaultPrevented()||((newTask||!newTask&&"rejected"==task.state())&&(task=tasks[id]=query.task=query.lookup()),task.done(self.render(function(items){return[items,query]})),self.trigger("queryStart",[query]))};newTask?(clearTimeout(self.delayTask),self.delayTask=setTimeout(runTask,250)):runTask()}},"{self} queryPrepare":function(el,event,query){el.removeClass("loading empty search"),query.loadingHint&&self.hide()},"{self} queryBeforeStart":function(el,event,query){var loadingHint=query.loadingHint;loadingHint&&(self.loadingHint().html($.isString(loadingHint)?loadingHint:self.defaultLoadingHint),el.addClass("loading"),self.show())
},"{self} queryStart":function(el,event,query){query.task.fail(function(){self.hide()}).always(function(){el.removeClass("loading")})},render:$.Enqueue(function(items,query){if(query.aborted)return void self.hide();$.isArray(items)||(items=[]);var mentions=self.mentions,autocomplete=self,element=self.element,menu=self.menu(),keyword=query.keyword;if(items.length<1){var emptyHint=query.emptyHint;return emptyHint?(self.emptyHint().html($.isString(emptyHint)?emptyHint:self.defaultEmptyHint),menu.empty(),element.addClass("empty"),self.show(2e3)):self.hide(),void mentions.trigger("menuRender",[menu,query,autocomplete,mentions])
}element.removeClass("empty"),query.cache&&menu.data("keyword")===keyword||(menu.empty(),$.each(items,function(i,item){if(mentions.trigger("menuCreateItem",[item,query,autocomplete,mentions]),$.isPlainObject(item)&&!item.discard){var html=item.menuHtml||item.title;self.view.menuItem({html:html}).data("item",item).appendTo(menu)}}),menu.data("keyword",keyword));var menuItems=self.menuItem();return mentions.trigger("menuCreate",[menu,menuItems,query,autocomplete,mentions]),menuItems.filter(":not(.hidden)").length<1&&(element.addClass("empty"),!query.emptyHint)?self.hide():(query.exclusive&&self.menuItem(":not(.hidden):first").addClass("active"),mentions.trigger("renderMenu",[menu,query,autocomplete,mentions]),void self.show())
}),"{mentions.textarea} keydown":function(textarea,event){clearTimeout(self.sleep);var activeMenuItem=self.menuItem(".active:not(.hidden)");switch(activeMenuItem.length<1&&(activeMenuItem=!1),event.keyCode){case KEYCODE.UP:self.menuItem().removeClass("active"),activeMenuItem?activeMenuItem.prev(self.menuItem.selector+":not(.hidden)").addClass("active"):self.menuItem(":not(.hidden):last").addClass("active"),self.hidden||event.preventDefault();break;case KEYCODE.DOWN:self.menuItem().removeClass("active"),activeMenuItem?activeMenuItem.next(self.menuItem.selector+":not(.hidden)").addClass("active"):self.menuItem(":not(.hidden):first").addClass("active"),self.hidden||event.preventDefault();
break;case KEYCODE.ESCAPE:self.hide();break;case KEYCODE.ENTER:if(!self.hidden&&activeMenuItem){var item=activeMenuItem.data("item");self.use(item),event.preventDefault()}}var activeMenuItem=self.menuItem(".active:not(.hidden)");self.hidden||self.viewport().scrollIntoView(activeMenuItem)},"{menuItem} mouseup":function(menuItem){self.hide();var item=menuItem.data("item");self.use(item),setTimeout(function(){self.mentions.textarea().focus()},150)},use:function(item){var query=self.activeQuery;if(query){var marker=query.marker,title=item.title;
marker.text.nodeValue=title,delete item.menuHtml;var value=item;query.use&&(value=query.use(item)),marker.finalize(value),self.mentions.textareaInsert(title,marker.start,marker.end),self.mentions.textarea().caret(marker.start+title.length),self.mentions.normalize(),self.hidden=!0,self.hide()}},"{menuItem} mouseover":function(menuItem){self.menuItem().removeClass("active"),menuItem.addClass("active")},"{menuItem} mouseout":function(){self.menuItem().removeClass("active")},"{closeButton} click":function(){self.hide()
},"{mentions} destroyed":function(){self.element.remove()}}}),$.template("mentions/inspector",'<div class="mentions-inspector" data-mentions-inspector><fieldset><b>Selection</b><hr/><label>Start</label><input type="text" data-mentions-selection-start/><hr/><label>End</label><input type="text" data-mentions-selection-end/><hr/><label>Length</label><input type="text" data-mentions-selection-length/><hr/></fieldset><fieldset><b>Trigger</b><hr/><label>Key</label><input type="text" data-mentions-trigger-key/><hr/><label>Type</label><input type="text" data-mentions-trigger-type/><hr/><label>Buffer</label><input type="text" data-mentions-trigger-buffer/><hr/></fieldset><hr/> <fieldset><b>Marker</b><hr/><label>Index</label><input type="text" data-mentions-marker-index/><hr/><label>Start</label><input type="text" data-mentions-marker-start/><hr/><label>End</label><input type="text" data-mentions-marker-end/><hr/><label>Length</label><input type="text" data-mentions-marker-length/><hr/><label>Text</label><input type="text" data-mentions-marker-text/><hr/></fieldset><fieldset><b>Block</b><hr/><label>Html</label><input type="text" data-mentions-block-html/><hr/><label>Text</label><input type="text" data-mentions-block-text/><hr/><label>Type</label><input type="text" data-mentions-block-type/><hr/><label>Value</label><input type="text" data-mentions-block-value/><hr/></fieldset></div>'),$.Controller("Mentions.Inspector",{defaultOptions:{view:{item:"mentions/item",inspector:"mentions/inspector"},"{inspector}":"[data-mentions-inspector]","{selectionStart}":"[data-mentions-selection-start]","{selectionEnd}":"[data-mentions-selection-end]","{selectionLength}":"[data-mentions-selection-length]","{markerIndex}":"[data-mentions-marker-index]","{markerStart}":"[data-mentions-marker-start]","{markerEnd}":"[data-mentions-marker-end]","{markerLength}":"[data-mentions-marker-length]","{markerText}":"[data-mentions-marker-text]","{blockText}":"[data-mentions-block-text]","{blockHtml}":"[data-mentions-block-html]","{blockType}":"[data-mentions-block-type]","{blockValue}":"[data-mentions-block-value]","{triggerKey}":"[data-mentions-trigger-key]","{triggerType}":"[data-mentions-trigger-type]","{triggerBuffer}":"[data-mentions-trigger-buffer]"}},function(self){return{init:function(){},showInspector:function(){self.inspector().length<1&&self.view.inspector().appendTo(self.element),self.inspector().show(),self.mentions.overlay().css("color","green")
},hideInspector:function(){self.inspector().hide(),self.mentions.overlay().css("color","transparent")},"{mentions.textarea} keyup":function(){self.inspect()},"{inspector} dblclick":function(){self.textarea().toggle()},inspect:$.debounce(function(){var caret=self.mentions.textarea().caret();self.selectionStart().val(caret.start),self.selectionEnd().val(caret.end),self.selectionLength().val(caret.end-caret.start);var triggerKey=self.triggered;if(triggerKey){var trigger=self.getTrigger(triggerKey);self.triggerKey().val(triggerKey),self.triggerType().val(trigger.type),self.triggerBuffer().val(self.buffer)
}else self.triggerKey().val(""),self.triggerType().val(""),self.triggerBuffer().val("");var marker=self.mentions.getMarkerAt(caret.start);marker?(self.markerIndex().val(marker.index).data("marker",marker),self.markerStart().val(marker.start),self.markerEnd().val(marker.end),self.markerLength().val(marker.length),self.markerText().val(marker.text.nodeValue)):(self.markerIndex().val("").data("marker",null),self.markerStart().val(""),self.markerEnd().val(""),self.markerLength().val(""),self.markerText().val(""));
var block=(marker||{}).block;block?(self.blockText().val(marker.text.nodeValue),self.blockHtml().val($(block).clone().toHTML())):(self.blockText().val(""),self.blockHtml().val(""))},25),"{markerIndex} click":function(el){console.dir(el.data("marker"))}}})};exports(),module.resolveWith(exports)};FD40.module("mentions",moduleFactory)}();