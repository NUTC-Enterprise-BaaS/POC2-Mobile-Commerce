!function(){var moduleFactory=function($){var module=this,exports=function(){!function(exports,undefined){"use strict";function require(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(module=modules[ids[i]]||resolve(ids[i]),!module)throw"module definition dependecy not found: "+ids[i];defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if("string"!=typeof id)throw"invalid module definition, module id must be defined and be a string";if(dependencies===undefined)throw"invalid module definition, dependencies must be specified";
if(definition===undefined)throw"invalid module definition, definition function must be specified";require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}function expose(ids){for(var i=0;i<ids.length;i++){for(var target=exports,id=ids[i],fragments=id.split(/[.\/]/),fi=0;fi<fragments.length-1;++fi)target[fragments[fi]]===undefined&&(target[fragments[fi]]={}),target=target[fragments[fi]];
target[fragments[fragments.length-1]]=modules[id]}}var modules={};define("moxie/core/utils/Basic",[],function(){var typeOf=function(o){var undef;return o===undef?"undefined":null===o?"null":o.nodeType?"node":{}.toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend=function(target){var undef;return each(arguments,function(arg,i){i>0&&each(arg,function(value,key){value!==undef&&(typeOf(target[key])===typeOf(value)&&~inArray(typeOf(value),["array","object"])?extend(target[key],value):target[key]=value)
})}),target},each=function(obj,callback){var length,key,i,undef;if(obj){try{length=obj.length}catch(ex){length=undef}if(length===undef){for(key in obj)if(obj.hasOwnProperty(key)&&callback(obj[key],key)===!1)return}else for(i=0;length>i;i++)if(callback(obj[i],i)===!1)return}},isEmptyObj=function(obj){var prop;if(!obj||"object"!==typeOf(obj))return!0;for(prop in obj)return!1;return!0},inSeries=function(queue,cb){function callNext(i){"function"===typeOf(queue[i])&&queue[i](function(error){++i<length&&!error?callNext(i):cb(error)
})}var i=0,length=queue.length;"function"!==typeOf(cb)&&(cb=function(){}),queue&&queue.length||cb(),callNext(i)},inParallel=function(queue,cb){var count=0,num=queue.length,cbArgs=new Array(num);each(queue,function(fn,i){fn(function(error){if(error)return cb(error);var args=[].slice.call(arguments);args.shift(),cbArgs[i]=args,count++,count===num&&(cbArgs.unshift(null),cb.apply(this,cbArgs))})})},inArray=function(needle,array){if(array){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(array,needle);
for(var i=0,length=array.length;length>i;i++)if(array[i]===needle)return i}return-1},arrayDiff=function(needles,array){var diff=[];"array"!==typeOf(needles)&&(needles=[needles]),"array"!==typeOf(array)&&(array=[array]);for(var i in needles)-1===inArray(needles[i],array)&&diff.push(needles[i]);return diff.length?diff:!1},arrayIntersect=function(array1,array2){var result=[];return each(array1,function(item){-1!==inArray(item,array2)&&result.push(item)}),result.length?result:null},toArray=function(obj){var i,arr=[];
for(i=0;i<obj.length;i++)arr[i]=obj[i];return arr},guid=function(){var counter=0;return function(prefix){var i,guid=(new Date).getTime().toString(32);for(i=0;5>i;i++)guid+=Math.floor(65535*Math.random()).toString(32);return(prefix||"o_")+guid+(counter++).toString(32)}}(),trim=function(str){return str?String.prototype.trim?String.prototype.trim.call(str):str.toString().replace(/^\s*/,"").replace(/\s*$/,""):str},parseSizeStr=function(size){if("string"!=typeof size)return size;var mul,muls={t:1099511627776,g:1073741824,m:1048576,k:1024};
return size=/^([0-9]+)([mgk]?)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,"")),mul=size[2],size=+size[1],muls.hasOwnProperty(mul)&&(size*=muls[mul]),size};return{guid:guid,typeOf:typeOf,extend:extend,each:each,isEmptyObj:isEmptyObj,inSeries:inSeries,inParallel:inParallel,inArray:inArray,arrayDiff:arrayDiff,arrayIntersect:arrayIntersect,toArray:toArray,trim:trim,parseSizeStr:parseSizeStr}}),define("moxie/core/I18n",["moxie/core/utils/Basic"],function(Basic){var i18n={};return{addI18n:function(pack){return Basic.extend(i18n,pack)
},translate:function(str){return i18n[str]||str},_:function(str){return this.translate(str)},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return"undefined"!==Basic.typeOf(value)?value:""})}}}),define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(Basic,I18n){var mimeData="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",Mime={mimes:{},extensions:{},addMimeType:function(mimeData){var i,ii,ext,items=mimeData.split(/,/);
for(i=0;i<items.length;i+=2){for(ext=items[i+1].split(/ /),ii=0;ii<ext.length;ii++)this.mimes[ext[ii]]=items[i];this.extensions[items[i]]=ext}},extList2mimes:function(filters,addMissingExtensions){var ext,i,ii,type,self=this,mimes=[];for(i=0;i<filters.length;i++)for(ext=filters[i].extensions.split(/\s*,\s*/),ii=0;ii<ext.length;ii++){if("*"===ext[ii])return[];if(type=self.mimes[ext[ii]])-1===Basic.inArray(type,mimes)&&mimes.push(type);else{if(!addMissingExtensions||!/^\w+$/.test(ext[ii]))return[];mimes.push("."+ext[ii])
}}return mimes},mimes2exts:function(mimes){var self=this,exts=[];return Basic.each(mimes,function(mime){if("*"===mime)return exts=[],!1;var m=mime.match(/^(\w+)\/(\*|\w+)$/);m&&("*"===m[2]?Basic.each(self.extensions,function(arr,mime){new RegExp("^"+m[1]+"/").test(mime)&&[].push.apply(exts,self.extensions[mime])}):self.extensions[mime]&&[].push.apply(exts,self.extensions[mime]))}),exts},mimes2extList:function(mimes){var accept=[],exts=[];return"string"===Basic.typeOf(mimes)&&(mimes=Basic.trim(mimes).split(/\s*,\s*/)),exts=this.mimes2exts(mimes),accept.push({title:I18n.translate("Files"),extensions:exts.length?exts.join(","):"*"}),accept.mimes=mimes,accept
},getFileExtension:function(fileName){var matches=fileName&&fileName.match(/\.([^.]+)$/);return matches?matches[1].toLowerCase():""},getFileMime:function(fileName){return this.mimes[this.getFileExtension(fileName)]||""}};return Mime.addMimeType(mimeData),Mime}),define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(Basic){function version_compare(v1,v2,operator){var i=0,x=0,compare=0,vm={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},prepVersion=function(v){return v=(""+v).replace(/[_\-+]/g,"."),v=v.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),v.length?v.split("."):[-8]
},numVersion=function(v){return v?isNaN(v)?vm[v]||-7:parseInt(v,10):0};for(v1=prepVersion(v1),v2=prepVersion(v2),x=Math.max(v1.length,v2.length),i=0;x>i;i++)if(v1[i]!=v2[i]){if(v1[i]=numVersion(v1[i]),v2[i]=numVersion(v2[i]),v1[i]<v2[i]){compare=-1;break}if(v1[i]>v2[i]){compare=1;break}}if(!operator)return compare;switch(operator){case">":case"gt":return compare>0;case">=":case"ge":return compare>=0;case"<=":case"le":return 0>=compare;case"==":case"=":case"eq":return 0===compare;case"<>":case"!=":case"ne":return 0!==compare;
case"":case"<":case"lt":return 0>compare;default:return null}}var UAParser=function(undefined){var EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",MAJOR="major",NAME="name",VERSION="version",util={has:function(str1,str2){return-1!==str2.toLowerCase().indexOf(str1.toLowerCase())},lowerize:function(str){return str.toLowerCase()}},mapper={rgx:function(){for(var result,j,k,p,q,matches,match,i=0,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof result===UNDEF_TYPE){result={};
for(p in props)q=props[p],typeof q===OBJ_TYPE?result[q[0]]=undefined:result[q]=undefined}for(j=k=0;j<regex.length;j++)if(matches=regex[j].exec(this.getUA())){for(p=0;p<props.length;p++)match=matches[++k],q=props[p],typeof q===OBJ_TYPE&&q.length>0?2==q.length?result[q[0]]=typeof q[1]==FUNC_TYPE?q[1].call(this,match):q[1]:3==q.length?result[q[0]]=typeof q[1]!==FUNC_TYPE||q[1].exec&&q[1].test?match?match.replace(q[1],q[2]):undefined:match?q[1].call(this,match,q[2]):undefined:4==q.length&&(result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined):result[q]=match?match:undefined;
break}if(matches)break}return result},str:function(str,map){for(var i in map)if(typeof map[i]===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++)if(util.has(map[i][j],str))return i===UNKNOWN?undefined:i}else if(util.has(map[i],str))return i===UNKNOWN?undefined:i;return str}},maps={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},regexes={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,"Opera"],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,"Yandex"],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g," "],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,"Dolphin"],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,"Chrome"],VERSION,MAJOR],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[NAME,"Android Browser"],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,"Netscape"],VERSION,MAJOR],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]},UAParser=function(uastring){var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:EMPTY);
this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser)},this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine)},this.getOS=function(){return mapper.rgx.apply(this,regexes.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return ua},this.setUA=function(uastring){return ua=uastring,this},this.setUA(ua)};return(new UAParser).getResult()}(),can=function(){var caps={define_property:function(){return!1
}(),create_canvas:function(){var el=document.createElement("canvas");return!(!el.getContext||!el.getContext("2d"))}(),return_response_type:function(responseType){try{if(-1!==Basic.inArray(responseType,["","text","document"]))return!0;if(window.XMLHttpRequest){var xhr=new XMLHttpRequest;if(xhr.open("get","/"),"responseType"in xhr)return xhr.responseType=responseType,xhr.responseType!==responseType?!1:!0}}catch(ex){}return!1},use_data_uri:function(){var du=new Image;return du.onload=function(){caps.use_data_uri=1===du.width&&1===du.height
},setTimeout(function(){du.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return caps.use_data_uri&&("IE"!==Env.browser||Env.version>=9)},use_data_uri_of:function(bytes){return caps.use_data_uri&&33e3>bytes||caps.use_data_uri_over32kb()},use_fileinput:function(){var el=document.createElement("input");return el.setAttribute("type","file"),!el.disabled}};return function(cap){var args=[].slice.call(arguments);return args.shift(),"function"===Basic.typeOf(caps[cap])?caps[cap].apply(this,args):!!caps[cap]
}}(),Env={can:can,browser:UAParser.browser.name,version:parseFloat(UAParser.browser.major),os:UAParser.os.name,osVersion:UAParser.os.version,verComp:version_compare,swf_url:$.path+"/scripts/plupload2/Moxie.swf",xap_url:$.path+"/scripts/plupload2/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return Env.OS=Env.os,Env}),define("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(Env){var get=function(id){return"string"!=typeof id?id:document.getElementById(id)},hasClass=function(obj,name){if(!obj.className)return!1;
var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");return regExp.test(obj.className)},addClass=function(obj,name){hasClass(obj,name)||(obj.className=obj.className?obj.className.replace(/\s+$/,"")+" "+name:name)},removeClass=function(obj,name){if(obj.className){var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");obj.className=obj.className.replace(regExp,function($0,$1,$2){return" "===$1&&" "===$2?" ":""})}},getStyle=function(obj,name){return obj.currentStyle?obj.currentStyle[name]:window.getComputedStyle?window.getComputedStyle(obj,null)[name]:void 0
},getPos=function(node,root){function getIEPos(node){var bodyElm,rect,x=0,y=0;return node&&(rect=node.getBoundingClientRect(),bodyElm="CSS1Compat"===doc.compatMode?doc.documentElement:doc.body,x=rect.left+bodyElm.scrollLeft,y=rect.top+bodyElm.scrollTop),{x:x,y:y}}var parent,nodeRect,rootRect,x=0,y=0,doc=document;if(node=node,root=root||doc.body,node&&node.getBoundingClientRect&&"IE"===Env.browser&&(!doc.documentMode||doc.documentMode<8))return nodeRect=getIEPos(node),rootRect=getIEPos(root),{x:nodeRect.x-rootRect.x,y:nodeRect.y-rootRect.y};
for(parent=node;parent&&parent!=root&&parent.nodeType;)x+=parent.offsetLeft||0,y+=parent.offsetTop||0,parent=parent.offsetParent;for(parent=node.parentNode;parent&&parent!=root&&parent.nodeType;)x-=parent.scrollLeft||0,y-=parent.scrollTop||0,parent=parent.parentNode;return{x:x,y:y}},getSize=function(node){return{w:node.offsetWidth||node.clientWidth,h:node.offsetHeight||node.clientHeight}};return{get:get,hasClass:hasClass,addClass:addClass,removeClass:removeClass,getStyle:getStyle,getPos:getPos,getSize:getSize}
}),define("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(Basic){function _findKey(obj,value){var key;for(key in obj)if(obj[key]===value)return key;return null}return{RuntimeError:function(){function RuntimeError(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+": RuntimeError "+this.code}var namecodes={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return Basic.extend(RuntimeError,namecodes),RuntimeError.prototype=Error.prototype,RuntimeError}(),OperationNotAllowedException:function(){function OperationNotAllowedException(code){this.code=code,this.name="OperationNotAllowedException"
}return Basic.extend(OperationNotAllowedException,{NOT_ALLOWED_ERR:1}),OperationNotAllowedException.prototype=Error.prototype,OperationNotAllowedException}(),ImageError:function(){function ImageError(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+": ImageError "+this.code}var namecodes={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return Basic.extend(ImageError,namecodes),ImageError.prototype=Error.prototype,ImageError}(),FileException:function(){function FileException(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+": FileException "+this.code
}var namecodes={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return Basic.extend(FileException,namecodes),FileException.prototype=Error.prototype,FileException}(),DOMException:function(){function DOMException(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+": DOMException "+this.code}var namecodes={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};
return Basic.extend(DOMException,namecodes),DOMException.prototype=Error.prototype,DOMException}(),EventException:function(){function EventException(code){this.code=code,this.name="EventException"}return Basic.extend(EventException,{UNSPECIFIED_EVENT_TYPE_ERR:0}),EventException.prototype=Error.prototype,EventException}()}}),define("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],function(x,Basic){function EventTarget(){var eventpool={};Basic.extend(this,{uid:null,init:function(){this.uid||(this.uid=Basic.guid("uid_"))
},addEventListener:function(type,fn,priority,scope){var list,self=this;return type=Basic.trim(type),/\s/.test(type)?void Basic.each(type.split(/\s+/),function(type){self.addEventListener(type,fn,priority,scope)}):(type=type.toLowerCase(),priority=parseInt(priority,10)||0,list=eventpool[this.uid]&&eventpool[this.uid][type]||[],list.push({fn:fn,priority:priority,scope:scope||this}),eventpool[this.uid]||(eventpool[this.uid]={}),void(eventpool[this.uid][type]=list))},hasEventListener:function(type){return type?!(!eventpool[this.uid]||!eventpool[this.uid][type]):!!eventpool[this.uid]
},removeEventListener:function(type,fn){type=type.toLowerCase();var i,list=eventpool[this.uid]&&eventpool[this.uid][type];if(list){if(fn){for(i=list.length-1;i>=0;i--)if(list[i].fn===fn){list.splice(i,1);break}}else list=[];list.length||(delete eventpool[this.uid][type],Basic.isEmptyObj(eventpool[this.uid])&&delete eventpool[this.uid])}},removeAllEventListeners:function(){eventpool[this.uid]&&delete eventpool[this.uid]},dispatchEvent:function(type){var uid,list,args,tmpEvt,undef,evt={},result=!0;if("string"!==Basic.typeOf(type)){if(tmpEvt=type,"string"!==Basic.typeOf(tmpEvt.type))throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);
type=tmpEvt.type,tmpEvt.total!==undef&&tmpEvt.loaded!==undef&&(evt.total=tmpEvt.total,evt.loaded=tmpEvt.loaded),evt.async=tmpEvt.async||!1}if(-1!==type.indexOf("::")?!function(arr){uid=arr[0],type=arr[1]}(type.split("::")):uid=this.uid,type=type.toLowerCase(),list=eventpool[uid]&&eventpool[uid][type]){list.sort(function(a,b){return b.priority-a.priority}),args=[].slice.call(arguments),args.shift(),evt.type=type,args.unshift(evt);var queue=[];Basic.each(list,function(handler){args[0].target=handler.scope,queue.push(evt.async?function(cb){setTimeout(function(){cb(handler.fn.apply(handler.scope,args)===!1)
},1)}:function(cb){cb(handler.fn.apply(handler.scope,args)===!1)})}),queue.length&&Basic.inSeries(queue,function(err){result=!err})}return result},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(handlers){var h;"array"!==Basic.typeOf(handlers)&&(handlers=[handlers]);
for(var i=0;i<handlers.length;i++)h="on"+handlers[i],"function"===Basic.typeOf(this[h])?this.addEventListener(handlers[i],this[h]):"undefined"===Basic.typeOf(this[h])&&(this[h]=null)}})}return EventTarget.instance=new EventTarget,EventTarget}),define("moxie/core/utils/Encode",[],function(){var utf8_encode=function(str){return unescape(encodeURIComponent(str))},utf8_decode=function(str_data){return decodeURIComponent(escape(str_data))},atob=function(data,utf8){if("function"==typeof window.atob)return utf8?utf8_decode(window.atob(data)):window.atob(data);
var o1,o2,o3,h1,h2,h3,h4,bits,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,ac=0,dec="",tmp_arr=[];if(!data)return data;data+="";do h1=b64.indexOf(data.charAt(i++)),h2=b64.indexOf(data.charAt(i++)),h3=b64.indexOf(data.charAt(i++)),h4=b64.indexOf(data.charAt(i++)),bits=h1<<18|h2<<12|h3<<6|h4,o1=bits>>16&255,o2=bits>>8&255,o3=255&bits,tmp_arr[ac++]=64==h3?String.fromCharCode(o1):64==h4?String.fromCharCode(o1,o2):String.fromCharCode(o1,o2,o3);while(i<data.length);return dec=tmp_arr.join(""),utf8?utf8_decode(dec):dec
},btoa=function(data,utf8){if(utf8&&utf8_encode(data),"function"==typeof window.btoa)return window.btoa(data);var o1,o2,o3,h1,h2,h3,h4,bits,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;do o1=data.charCodeAt(i++),o2=data.charCodeAt(i++),o3=data.charCodeAt(i++),bits=o1<<16|o2<<8|o3,h1=bits>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=63&bits,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);while(i<data.length);enc=tmp_arr.join("");
var r=data.length%3;return(r?enc.slice(0,r-3):enc)+"===".slice(r||3)};return{utf8_encode:utf8_encode,utf8_decode:utf8_decode,atob:atob,btoa:btoa}}),define("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(Basic,Dom,EventTarget){function Runtime(options,type,caps,modeCaps,preferredMode){var _shim,self=this,_uid=Basic.guid(type+"_"),defaultMode=preferredMode||"browser";options=options||{},runtimes[_uid]=this,caps=Basic.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},caps),options.preferred_caps&&(defaultMode=Runtime.getMode(modeCaps,options.preferred_caps,defaultMode)),_shim=function(){var objpool={};
return{exec:function(uid,comp,fn,args){return _shim[comp]&&(objpool[uid]||(objpool[uid]={context:this,instance:new _shim[comp]}),objpool[uid].instance[fn])?objpool[uid].instance[fn].apply(this,args):void 0},removeInstance:function(uid){delete objpool[uid]},removeAllInstances:function(){var self=this;Basic.each(objpool,function(obj,uid){"function"===Basic.typeOf(obj.instance.destroy)&&obj.instance.destroy.call(obj.context),self.removeInstance(uid)})}}}(),Basic.extend(this,{initialized:!1,uid:_uid,type:type,mode:Runtime.getMode(modeCaps,options.required_caps,defaultMode),shimid:_uid+"_container",clients:0,options:options,can:function(cap,value){var refCaps=arguments[2]||caps;
if("string"===Basic.typeOf(cap)&&"undefined"===Basic.typeOf(value)&&(cap=Runtime.parseCaps(cap)),"object"===Basic.typeOf(cap)){for(var key in cap)if(!this.can(key,cap[key],refCaps))return!1;return!0}return"function"===Basic.typeOf(refCaps[cap])?refCaps[cap].call(this,value):value===refCaps[cap]},getShimContainer:function(){var container,shimContainer=Dom.get(this.shimid);return shimContainer||(container=this.options.container?Dom.get(this.options.container):document.body,shimContainer=document.createElement("div"),shimContainer.id=this.shimid,shimContainer.className="moxie-shim moxie-shim-"+this.type,Basic.extend(shimContainer.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),container.appendChild(shimContainer),container=null),shimContainer
},getShim:function(){return _shim},shimExec:function(component,action){var args=[].slice.call(arguments,2);return self.getShim().exec.call(this,this.uid,component,action,args)},exec:function(component,action){var args=[].slice.call(arguments,2);return self[component]&&self[component][action]?self[component][action].apply(this,args):self.shimExec.apply(this,arguments)},destroy:function(){if(self){var shimContainer=Dom.get(this.shimid);shimContainer&&shimContainer.parentNode.removeChild(shimContainer),_shim&&_shim.removeAllInstances(),this.unbindAll(),delete runtimes[this.uid],this.uid=null,_uid=self=_shim=shimContainer=null
}}}),this.mode&&options.required_caps&&!this.can(options.required_caps)&&(this.mode=!1)}var runtimeConstructors={},runtimes={};return Runtime.order="html5,flash,silverlight,html4",Runtime.getRuntime=function(uid){return runtimes[uid]?runtimes[uid]:!1},Runtime.addConstructor=function(type,constructor){constructor.prototype=EventTarget.instance,runtimeConstructors[type]=constructor},Runtime.getConstructor=function(type){return runtimeConstructors[type]||null},Runtime.getInfo=function(uid){var runtime=Runtime.getRuntime(uid);
return runtime?{uid:runtime.uid,type:runtime.type,mode:runtime.mode,can:function(){return runtime.can.apply(runtime,arguments)}}:null},Runtime.parseCaps=function(capStr){var capObj={};return"string"!==Basic.typeOf(capStr)?capStr||{}:(Basic.each(capStr.split(","),function(key){capObj[key]=!0}),capObj)},Runtime.can=function(type,caps){var runtime,mode,constructor=Runtime.getConstructor(type);return constructor?(runtime=new constructor({required_caps:caps}),mode=runtime.mode,runtime.destroy(),!!mode):!1},Runtime.thatCan=function(caps,runtimeOrder){var types=(runtimeOrder||Runtime.order).split(/\s*,\s*/);
for(var i in types)if(Runtime.can(types[i],caps))return types[i];return null},Runtime.getMode=function(modeCaps,requiredCaps,defaultMode){var mode=null;if("undefined"===Basic.typeOf(defaultMode)&&(defaultMode="browser"),requiredCaps&&!Basic.isEmptyObj(modeCaps)){if(Basic.each(requiredCaps,function(value,cap){if(modeCaps.hasOwnProperty(cap)){var capMode=modeCaps[cap](value);if("string"==typeof capMode&&(capMode=[capMode]),mode){if(!(mode=Basic.arrayIntersect(mode,capMode)))return mode=!1}else mode=capMode}}),mode)return-1!==Basic.inArray(defaultMode,mode)?defaultMode:mode[0];
if(mode===!1)return!1}return defaultMode},Runtime.capTrue=function(){return!0},Runtime.capFalse=function(){return!1},Runtime.capTest=function(expr){return function(){return!!expr}},Runtime}),define("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(x,Basic,Runtime){return function(){var runtime;Basic.extend(this,{connectRuntime:function(options){function initialize(items){var type,constructor;return items.length?(type=items.shift(),(constructor=Runtime.getConstructor(type))?(runtime=new constructor(options),runtime.bind("Init",function(){runtime.initialized=!0,setTimeout(function(){runtime.clients++,comp.trigger("RuntimeInit",runtime)
},1)}),runtime.bind("Error",function(){runtime.destroy(),initialize(items)}),runtime.mode?void runtime.init():void runtime.trigger("Error")):void initialize(items)):(comp.trigger("RuntimeError",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)),void(runtime=null))}var ruid,comp=this;if("string"===Basic.typeOf(options)?ruid=options:"string"===Basic.typeOf(options.ruid)&&(ruid=options.ruid),ruid){if(runtime=Runtime.getRuntime(ruid))return runtime.clients++,runtime;throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)
}initialize((options.runtime_order||Runtime.order).split(/\s*,\s*/))},getRuntime:function(){return runtime&&runtime.uid?runtime:(runtime=null,null)},disconnectRuntime:function(){runtime&&--runtime.clients<=0&&(runtime.destroy(),runtime=null)}})}}),define("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(Basic,Encode,RuntimeClient){function Blob(ruid,blob){function _sliceDetached(start,end,type){var blob,data=blobpool[this.uid];return"string"===Basic.typeOf(data)&&data.length?(blob=new Blob(null,{type:type,size:end-start}),blob.detach(data.substr(start,blob.size)),blob):null
}RuntimeClient.call(this),ruid&&this.connectRuntime(ruid),blob?"string"===Basic.typeOf(blob)&&(blob={data:blob}):blob={},Basic.extend(this,{uid:blob.uid||Basic.guid("uid_"),ruid:ruid,size:blob.size||0,type:blob.type||"",slice:function(start,end,type){return this.isDetached()?_sliceDetached.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),start,end,type)},getSource:function(){return blobpool[this.uid]?blobpool[this.uid]:null},detach:function(data){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),data=data||"";
var matches=data.match(/^data:([^;]*);base64,/);matches&&(this.type=matches[1],data=Encode.atob(data.substring(data.indexOf("base64,")+7))),this.size=data.length,blobpool[this.uid]=data},isDetached:function(){return!this.ruid&&"string"===Basic.typeOf(blobpool[this.uid])},destroy:function(){this.detach(),delete blobpool[this.uid]}}),blob.data?this.detach(blob.data):blobpool[this.uid]=blob}var blobpool={};return Blob}),define("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(Basic,Mime,Blob){function File(ruid,file){var name,type;
if(file||(file={}),type=file.type&&""!==file.type?file.type:Mime.getFileMime(file.name),file.name)name=file.name.replace(/\\/g,"/"),name=name.substr(name.lastIndexOf("/")+1);else{var prefix=type.split("/")[0];name=Basic.guid((""!==prefix?prefix:"file")+"_"),Mime.extensions[type]&&(name+="."+Mime.extensions[type][0])}Blob.apply(this,arguments),Basic.extend(this,{type:type||"",name:name||Basic.guid("file_"),lastModifiedDate:file.lastModifiedDate||(new Date).toLocaleString()})}return File.prototype=Blob.prototype,File
}),define("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/file/File","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(Basic,Mime,Dom,x,EventTarget,I18n,File,Runtime,RuntimeClient){function FileInput(options){var container,browseButton,defaults,self=this;if(-1!==Basic.inArray(Basic.typeOf(options),["string","node"])&&(options={browse_button:options}),browseButton=Dom.get(options.browse_button),!browseButton)throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);
defaults={accept:[{title:I18n.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:browseButton.parentNode||document.body},options=Basic.extend({},defaults,options),"string"==typeof options.required_caps&&(options.required_caps=Runtime.parseCaps(options.required_caps)),"string"==typeof options.accept&&(options.accept=Mime.mimes2extList(options.accept)),container=Dom.get(options.container),container||(container=document.body),"static"===Dom.getStyle(container,"position")&&(container.style.position="relative"),container=browseButton=null,RuntimeClient.call(self),Basic.extend(self,{uid:Basic.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches),self.bind("RuntimeInit",function(e,runtime){self.ruid=runtime.uid,self.shimid=runtime.shimid,self.bind("Ready",function(){self.trigger("Refresh")
},999),self.bind("Change",function(){var files=runtime.exec.call(self,"FileInput","getFiles");self.files=[],Basic.each(files,function(file){return 0===file.size?!0:void self.files.push(new File(self.ruid,file))})},999),self.bind("Refresh",function(){var pos,size,browseButton,shimContainer;browseButton=Dom.get(options.browse_button),shimContainer=Dom.get(runtime.shimid),browseButton&&(pos=Dom.getPos(browseButton,Dom.get(options.container)),size=Dom.getSize(browseButton),shimContainer&&Basic.extend(shimContainer.style,{top:pos.y+"px",left:pos.x+"px",width:size.w+"px",height:size.h+"px"})),shimContainer=browseButton=null
}),runtime.exec.call(self,"FileInput","init",options)}),self.connectRuntime(Basic.extend({},options,{required_caps:{select_file:!0}}))},disable:function(state){var runtime=this.getRuntime();runtime&&runtime.exec.call(this,"FileInput","disable","undefined"===Basic.typeOf(state)?!0:state)},refresh:function(){self.trigger("Refresh")},destroy:function(){var runtime=this.getRuntime();runtime&&(runtime.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===Basic.typeOf(this.files)&&Basic.each(this.files,function(file){file.destroy()
}),this.files=null}})}var dispatches=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return FileInput.prototype=EventTarget.instance,FileInput}),define("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(I18n,Dom,x,Basic,File,RuntimeClient,EventTarget,Mime){function FileDrop(options){var defaults,self=this;"string"==typeof options&&(options={drop_zone:options}),defaults={accept:[{title:I18n.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},options="object"==typeof options?Basic.extend({},defaults,options):defaults,options.container=Dom.get(options.drop_zone)||document.body,"static"===Dom.getStyle(options.container,"position")&&(options.container.style.position="relative"),"string"==typeof options.accept&&(options.accept=Mime.mimes2extList(options.accept)),RuntimeClient.call(self),Basic.extend(self,{uid:Basic.guid("uid_"),ruid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches),self.bind("RuntimeInit",function(e,runtime){self.ruid=runtime.uid,self.bind("Drop",function(){var files=runtime.exec.call(self,"FileDrop","getFiles");
self.files=[],Basic.each(files,function(file){self.files.push(new File(self.ruid,file))})},999),runtime.exec.call(self,"FileDrop","init",options),self.dispatchEvent("ready")}),self.connectRuntime(options)},destroy:function(){var runtime=this.getRuntime();runtime&&(runtime.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var dispatches=["ready","dragenter","dragleave","drop","error"];return FileDrop.prototype=EventTarget.instance,FileDrop}),define("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(Basic,RuntimeClient,EventTarget){function RuntimeTarget(){this.uid=Basic.guid("uid_"),RuntimeClient.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()
}}return RuntimeTarget.prototype=EventTarget.instance,RuntimeTarget}),define("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/runtime/RuntimeTarget"],function(Basic,Encode,x,EventTarget,Blob,File,RuntimeTarget){function FileReader(){function _read(op,blob){function error(err){self.readyState=FileReader.DONE,self.error=err,self.trigger("error"),loadEnd()}function loadEnd(){_fr.destroy(),_fr=null,self.trigger("loadend")
}function exec(runtime){_fr.bind("Error",function(e,err){error(err)}),_fr.bind("Progress",function(e){self.result=runtime.exec.call(_fr,"FileReader","getResult"),self.trigger(e)}),_fr.bind("Load",function(e){self.readyState=FileReader.DONE,self.result=runtime.exec.call(_fr,"FileReader","getResult"),self.trigger(e),loadEnd()}),runtime.exec.call(_fr,"FileReader","read",op,blob)}if(_fr=new RuntimeTarget,this.convertEventPropsToHandlers(dispatches),this.readyState===FileReader.LOADING)return error(new x.DOMException(x.DOMException.INVALID_STATE_ERR));
if(this.readyState=FileReader.LOADING,this.trigger("loadstart"),blob instanceof Blob)if(blob.isDetached()){var src=blob.getSource();switch(op){case"readAsText":case"readAsBinaryString":this.result=src;break;case"readAsDataURL":this.result="data:"+blob.type+";base64,"+Encode.btoa(src)}this.readyState=FileReader.DONE,this.trigger("load"),loadEnd()}else exec(_fr.connectRuntime(blob.ruid));else error(new x.DOMException(x.DOMException.NOT_FOUND_ERR))}var _fr,self=this;Basic.extend(this,{uid:Basic.guid("uid_"),readyState:FileReader.EMPTY,result:null,error:null,readAsBinaryString:function(blob){_read.call(this,"readAsBinaryString",blob)
},readAsDataURL:function(blob){_read.call(this,"readAsDataURL",blob)},readAsText:function(blob){_read.call(this,"readAsText",blob)},abort:function(){this.result=null,-1===Basic.inArray(this.readyState,[FileReader.EMPTY,FileReader.DONE])&&(this.readyState===FileReader.LOADING&&(this.readyState=FileReader.DONE),_fr&&_fr.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),_fr&&(_fr.getRuntime().exec.call(this,"FileReader","destroy"),_fr.disconnectRuntime()),self=_fr=null
}})}var dispatches=["loadstart","progress","load","abort","error","loadend"];return FileReader.EMPTY=0,FileReader.LOADING=1,FileReader.DONE=2,FileReader.prototype=EventTarget.instance,FileReader}),define("moxie/core/utils/Url",[],function(){var parseUrl=function(url,currentUrl){for(var key=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=key.length,ports={http:80,https:443},uri={},regex=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,m=regex.exec(url||"");i--;)m[i]&&(uri[key[i]]=m[i]);
if(!uri.scheme){currentUrl&&"string"!=typeof currentUrl||(currentUrl=parseUrl(currentUrl||document.location.href)),uri.scheme=currentUrl.scheme,uri.host=currentUrl.host,uri.port=currentUrl.port;var path="";/^[^\/]/.test(uri.path)&&(path=currentUrl.path,/(\/|\/[^\.]+)$/.test(path)?path+="/":path=path.replace(/\/[^\/]+$/,"/")),uri.path=path+(uri.path||"")}return uri.port||(uri.port=ports[uri.scheme]||80),uri.port=parseInt(uri.port,10),uri.path||(uri.path="/"),delete uri.source,uri},resolveUrl=function(url){var ports={http:80,https:443},urlp=parseUrl(url);
return urlp.scheme+"://"+urlp.host+(urlp.port!==ports[urlp.scheme]?":"+urlp.port:"")+urlp.path+(urlp.query?urlp.query:"")},hasSameOrigin=function(url){function origin(url){return[url.scheme,url.host,url.port].join("/")}return"string"==typeof url&&(url=parseUrl(url)),origin(parseUrl())===origin(url)};return{parseUrl:parseUrl,resolveUrl:resolveUrl,hasSameOrigin:hasSameOrigin}}),define("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(Basic,RuntimeClient,Encode){return function(){function _read(op,blob){if(!blob.isDetached()){var result=this.connectRuntime(blob.ruid).exec.call(this,"FileReaderSync","read",op,blob);
return this.disconnectRuntime(),result}var src=blob.getSource();switch(op){case"readAsBinaryString":return src;case"readAsDataURL":return"data:"+blob.type+";base64,"+Encode.btoa(src);case"readAsText":for(var txt="",i=0,length=src.length;length>i;i++)txt+=String.fromCharCode(src[i]);return txt}}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid("uid_"),readAsBinaryString:function(blob){return _read.call(this,"readAsBinaryString",blob)},readAsDataURL:function(blob){return _read.call(this,"readAsDataURL",blob)
},readAsText:function(blob){return _read.call(this,"readAsText",blob)}})}}),define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(x,Basic,Blob){function FormData(){var _blob,_fields=[];Basic.extend(this,{append:function(name,value){var self=this,valueType=Basic.typeOf(value);value instanceof Blob?_blob={name:name,value:value}:"array"===valueType?(name+="[]",Basic.each(value,function(value){self.append(name,value)})):"object"===valueType?Basic.each(value,function(value,key){self.append(name+"["+key+"]",value)
}):"null"===valueType||"undefined"===valueType||"number"===valueType&&isNaN(value)?self.append(name,"false"):_fields.push({name:name,value:value.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return _blob&&_blob.value||null},getBlobName:function(){return _blob&&_blob.name||null},each:function(cb){Basic.each(_fields,function(field){cb(field.value,field.name)}),_blob&&cb(_blob.value,_blob.name)},destroy:function(){_blob=null,_fields=[]}})}return FormData}),define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(Basic,x,EventTarget,Encode,Url,Runtime,RuntimeTarget,Blob,FileReaderSync,FormData,Env,Mime){function XMLHttpRequestUpload(){this.uid=Basic.guid("uid_")
}function XMLHttpRequest(){function _p(prop,value){return props.hasOwnProperty(prop)?1===arguments.length?Env.can("define_property")?props[prop]:self[prop]:void(Env.can("define_property")?props[prop]=value:self[prop]=value):void 0}function _doXHR(data){function loadEnd(){_xhr&&(_xhr.destroy(),_xhr=null),self.dispatchEvent("loadend"),self=null}function exec(runtime){_xhr.bind("LoadStart",function(e){_p("readyState",XMLHttpRequest.LOADING),self.dispatchEvent("readystatechange"),self.dispatchEvent(e),_upload_events_flag&&self.upload.dispatchEvent(e)
}),_xhr.bind("Progress",function(e){_p("readyState")!==XMLHttpRequest.LOADING&&(_p("readyState",XMLHttpRequest.LOADING),self.dispatchEvent("readystatechange")),self.dispatchEvent(e)}),_xhr.bind("UploadProgress",function(e){_upload_events_flag&&self.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),_xhr.bind("Load",function(e){_p("readyState",XMLHttpRequest.DONE),_p("status",Number(runtime.exec.call(_xhr,"XMLHttpRequest","getStatus")||0)),_p("statusText",httpCode[_p("status")]||""),_p("response",runtime.exec.call(_xhr,"XMLHttpRequest","getResponse",_p("responseType"))),~Basic.inArray(_p("responseType"),["text",""])?_p("responseText",_p("response")):"document"===_p("responseType")&&_p("responseXML",_p("response")),_responseHeaders=runtime.exec.call(_xhr,"XMLHttpRequest","getAllResponseHeaders"),self.dispatchEvent("readystatechange"),_p("status")>0?(_upload_events_flag&&self.upload.dispatchEvent(e),self.dispatchEvent(e)):(_error_flag=!0,self.dispatchEvent("error")),loadEnd()
}),_xhr.bind("Abort",function(e){self.dispatchEvent(e),loadEnd()}),_xhr.bind("Error",function(e){_error_flag=!0,_p("readyState",XMLHttpRequest.DONE),self.dispatchEvent("readystatechange"),_upload_complete_flag=!0,self.dispatchEvent(e),loadEnd()}),runtime.exec.call(_xhr,"XMLHttpRequest","send",{url:_url,method:_method,async:_async,user:_user,password:_password,headers:_headers,mimeType:_mimeType,encoding:_encoding,responseType:self.responseType,withCredentials:self.withCredentials,options:_options},data)}var self=this;
_start_time=(new Date).getTime(),_xhr=new RuntimeTarget,"string"==typeof _options.required_caps&&(_options.required_caps=Runtime.parseCaps(_options.required_caps)),_options.required_caps=Basic.extend({},_options.required_caps,{return_response_type:self.responseType}),data instanceof FormData&&(_options.required_caps.send_multipart=!0),_same_origin_flag||(_options.required_caps.do_cors=!0),_options.ruid?exec(_xhr.connectRuntime(_options)):(_xhr.bind("RuntimeInit",function(e,runtime){exec(runtime)}),_xhr.bind("RuntimeError",function(e,err){self.dispatchEvent("RuntimeError",err)
}),_xhr.connectRuntime(_options))}function _reset(){_p("responseText",""),_p("responseXML",null),_p("response",null),_p("status",0),_p("statusText",""),_start_time=_timeoutset_time=null}var _url,_method,_user,_password,_start_time,_timeoutset_time,_xhr,_responseHeadersBag,self=this,props={timeout:0,readyState:XMLHttpRequest.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},_async=!0,_headers={},_encoding=null,_mimeType=null,_sync_flag=!1,_send_flag=!1,_upload_events_flag=!1,_upload_complete_flag=!1,_error_flag=!1,_same_origin_flag=!1,_finalMime=null,_finalCharset=null,_options={},_responseHeaders="";
Basic.extend(this,props,{uid:Basic.guid("uid_"),upload:new XMLHttpRequestUpload,open:function(method,url,async,user,password){var urlp;if(!method||!url)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(/[Ā-￿]/.test(method)||Encode.utf8_encode(method)!==method)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(~Basic.inArray(method.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(_method=method.toUpperCase()),~Basic.inArray(_method,["CONNECT","TRACE","TRACK"]))throw new x.DOMException(x.DOMException.SECURITY_ERR);
if(url=Encode.utf8_encode(url),urlp=Url.parseUrl(url),_same_origin_flag=Url.hasSameOrigin(urlp),_url=Url.resolveUrl(url),(user||password)&&!_same_origin_flag)throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);if(_user=user||urlp.user,_password=password||urlp.pass,_async=async||!0,_async===!1&&(_p("timeout")||_p("withCredentials")||""!==_p("responseType")))throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);_sync_flag=!_async,_send_flag=!1,_headers={},_reset.call(this),_p("readyState",XMLHttpRequest.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")
},setRequestHeader:function(header,value){var uaHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(_p("readyState")!==XMLHttpRequest.OPENED||_send_flag)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(/[Ā-￿]/.test(header)||Encode.utf8_encode(header)!==header)throw new x.DOMException(x.DOMException.SYNTAX_ERR);
return header=Basic.trim(header).toLowerCase(),~Basic.inArray(header,uaHeaders)||/^(proxy\-|sec\-)/.test(header)?!1:(_headers[header]?_headers[header]+=", "+value:_headers[header]=value,!0)},getAllResponseHeaders:function(){return _responseHeaders||""},getResponseHeader:function(header){return header=header.toLowerCase(),_error_flag||~Basic.inArray(header,["set-cookie","set-cookie2"])?null:_responseHeaders&&""!==_responseHeaders&&(_responseHeadersBag||(_responseHeadersBag={},Basic.each(_responseHeaders.split(/\r\n/),function(line){var pair=line.split(/:\s+/);
2===pair.length&&(pair[0]=Basic.trim(pair[0]),_responseHeadersBag[pair[0].toLowerCase()]={header:pair[0],value:Basic.trim(pair[1])})})),_responseHeadersBag.hasOwnProperty(header))?_responseHeadersBag[header].header+": "+_responseHeadersBag[header].value:null},overrideMimeType:function(mime){var matches,charset;if(~Basic.inArray(_p("readyState"),[XMLHttpRequest.LOADING,XMLHttpRequest.DONE]))throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(mime=Basic.trim(mime.toLowerCase()),/;/.test(mime)&&(matches=mime.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(mime=matches[1],matches[2]&&(charset=matches[2])),!Mime.mimes[mime])throw new x.DOMException(x.DOMException.SYNTAX_ERR);
_finalMime=mime,_finalCharset=charset},send:function(data,options){if(_options="string"===Basic.typeOf(options)?{ruid:options}:options?options:{},this.convertEventPropsToHandlers(dispatches),this.upload.convertEventPropsToHandlers(dispatches),this.readyState!==XMLHttpRequest.OPENED||_send_flag)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(data instanceof Blob)_options.ruid=data.ruid,_mimeType=data.type||"application/octet-stream";else if(data instanceof FormData){if(data.hasBlob()){var blob=data.getBlob();
_options.ruid=blob.ruid,_mimeType=blob.type||"application/octet-stream"}}else"string"==typeof data&&(_encoding="UTF-8",_mimeType="text/plain;charset=UTF-8",data=Encode.utf8_encode(data));this.withCredentials||(this.withCredentials=_options.required_caps&&_options.required_caps.send_browser_cookies&&!_same_origin_flag),_upload_events_flag=!_sync_flag&&this.upload.hasEventListener(),_error_flag=!1,_upload_complete_flag=!data,_sync_flag||(_send_flag=!0),_doXHR.call(this,data)},abort:function(){if(_error_flag=!0,_sync_flag=!1,~Basic.inArray(_p("readyState"),[XMLHttpRequest.UNSENT,XMLHttpRequest.OPENED,XMLHttpRequest.DONE]))_p("readyState",XMLHttpRequest.UNSENT);
else{if(_p("readyState",XMLHttpRequest.DONE),_send_flag=!1,!_xhr)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);_xhr.getRuntime().exec.call(_xhr,"XMLHttpRequest","abort",_upload_complete_flag),_upload_complete_flag=!0}},destroy:function(){_xhr&&("function"===Basic.typeOf(_xhr.destroy)&&_xhr.destroy(),_xhr=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var httpCode={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};
XMLHttpRequestUpload.prototype=EventTarget.instance;var dispatches=["loadstart","progress","abort","error","load","timeout","loadend"];return XMLHttpRequest.UNSENT=0,XMLHttpRequest.OPENED=1,XMLHttpRequest.HEADERS_RECEIVED=2,XMLHttpRequest.LOADING=3,XMLHttpRequest.DONE=4,XMLHttpRequest.prototype=EventTarget.instance,XMLHttpRequest}),define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(Basic,Encode,RuntimeClient,EventTarget){function Transporter(){function _reset(){_size=_pos=0,_data=this.result=null
}function _run(type,runtime){var self=this;_runtime=runtime,self.bind("TransportingProgress",function(e){_pos=e.loaded,_size>_pos&&-1===Basic.inArray(self.state,[Transporter.IDLE,Transporter.DONE])&&_transport.call(self)},999),self.bind("TransportingComplete",function(){_pos=_size,self.state=Transporter.DONE,_data=null,self.result=_runtime.exec.call(self,"Transporter","getAsBlob",type||"")},999),self.state=Transporter.BUSY,self.trigger("TransportingStarted"),_transport.call(self)}function _transport(){var chunk,self=this,bytesLeft=_size-_pos;
_chunk_size>bytesLeft&&(_chunk_size=bytesLeft),chunk=Encode.btoa(_data.substr(_pos,_chunk_size)),_runtime.exec.call(self,"Transporter","receive",chunk,_size)}var mod,_runtime,_data,_size,_pos,_chunk_size;RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid("uid_"),state:Transporter.IDLE,result:null,transport:function(data,type,options){var self=this;if(options=Basic.extend({chunk_size:204798},options),(mod=options.chunk_size%3)&&(options.chunk_size+=3-mod),_chunk_size=options.chunk_size,_reset.call(this),_data=data,_size=data.length,"string"===Basic.typeOf(options)||options.ruid)_run.call(self,type,this.connectRuntime(options));
else{var cb=function(e,runtime){self.unbind("RuntimeInit",cb),_run.call(self,type,runtime)};this.bind("RuntimeInit",cb),this.connectRuntime(options)}},abort:function(){var self=this;self.state=Transporter.IDLE,_runtime&&(_runtime.exec.call(self,"Transporter","clear"),self.trigger("TransportingAborted")),_reset.call(self)},destroy:function(){this.unbindAll(),_runtime=null,this.disconnectRuntime(),_reset.call(this)}})}return Transporter.IDLE=0,Transporter.BUSY=1,Transporter.DONE=2,Transporter.prototype=EventTarget.instance,Transporter
}),define("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(Basic,Dom,x,FileReaderSync,XMLHttpRequest,Runtime,RuntimeClient,Transporter,Env,EventTarget,Blob,File,Encode){function Image(){function _updateInfo(info){info||(info=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=info.size,this.width=info.width,this.height=info.height,this.type=info.type,this.meta=info.meta,""===this.name&&(this.name=info.name)
}function _load(src){var srcType=Basic.typeOf(src);try{if(src instanceof Image){if(!src.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);_loadFromImage.apply(this,arguments)}else if(src instanceof Blob){if(!~Basic.inArray(src.type,["image/jpeg","image/png"]))throw new x.ImageError(x.ImageError.WRONG_FORMAT);_loadFromBlob.apply(this,arguments)}else if(-1!==Basic.inArray(srcType,["blob","file"]))_load.call(this,new File(null,src),arguments[1]);else if("string"===srcType)/^data:[^;]*;base64,/.test(src)?_load.call(this,new Blob(null,{data:src}),arguments[1]):_loadFromUrl.apply(this,arguments);
else{if("node"!==srcType||"img"!==src.nodeName.toLowerCase())throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);_load.call(this,src.src,arguments[1])}}catch(ex){this.trigger("error",ex.code)}}function _loadFromImage(img,exact){var runtime=this.connectRuntime(img.ruid);this.ruid=runtime.uid,runtime.exec.call(this,"Image","loadFromImage",img,"undefined"===Basic.typeOf(exact)?!0:exact)}function _loadFromBlob(blob,options){function exec(runtime){self.ruid=runtime.uid,runtime.exec.call(self,"Image","loadFromBlob",blob)
}var self=this;self.name=blob.name||"",blob.isDetached()?(this.bind("RuntimeInit",function(e,runtime){exec(runtime)}),options&&"string"==typeof options.required_caps&&(options.required_caps=Runtime.parseCaps(options.required_caps)),this.connectRuntime(Basic.extend({required_caps:{access_image_binary:!0,resize_image:!0}},options))):exec(this.connectRuntime(blob.ruid))}function _loadFromUrl(url,options){var xhr,self=this;xhr=new XMLHttpRequest,xhr.open("get",url),xhr.responseType="blob",xhr.onprogress=function(e){self.trigger(e)
},xhr.onload=function(){_loadFromBlob.call(self,xhr.response,!0)},xhr.onerror=function(e){self.trigger(e)},xhr.onloadend=function(){xhr.destroy()},xhr.bind("RuntimeError",function(e,err){self.trigger("RuntimeError",err)}),xhr.send(null,options)}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){_updateInfo.call(this)},999),this.convertEventPropsToHandlers(dispatches),_load.apply(this,arguments)
},downsize:function(opts){var defaults={width:this.width,height:this.height,crop:!1,preserveHeaders:!0};opts="object"==typeof opts?Basic.extend(defaults,opts):Basic.extend(defaults,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT)throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);this.getRuntime().exec.call(this,"Image","downsize",opts.width,opts.height,opts.crop,opts.preserveHeaders)
}catch(ex){this.trigger("error",ex.code)}},crop:function(width,height,preserveHeaders){this.downsize(width,height,!0,preserveHeaders)},getAsCanvas:function(){if(!Env.can("create_canvas"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);var runtime=this.connectRuntime(this.ruid);return runtime.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(type,quality){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return type||(type="image/jpeg"),"image/jpeg"!==type||quality||(quality=90),this.getRuntime().exec.call(this,"Image","getAsBlob",type,quality)
},getAsDataURL:function(type,quality){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",type,quality)},getAsBinaryString:function(type,quality){var dataUrl=this.getAsDataURL(type,quality);return Encode.atob(dataUrl.substring(dataUrl.indexOf("base64,")+7))},embed:function(el){function onResize(){if(Env.can("create_canvas")){var canvas=imgCopy.getAsCanvas();if(canvas)return el.appendChild(canvas),canvas=null,imgCopy.destroy(),void self.trigger("embedded")
}var dataUrl=imgCopy.getAsDataURL(type,quality);if(!dataUrl)throw new x.ImageError(x.ImageError.WRONG_FORMAT);if(Env.can("use_data_uri_of",dataUrl.length))el.innerHTML='<img src="'+dataUrl+'" width="'+imgCopy.width+'" height="'+imgCopy.height+'" />',imgCopy.destroy(),self.trigger("embedded");else{var tr=new Transporter;tr.bind("TransportingComplete",function(){runtime=self.connectRuntime(this.result.ruid),self.bind("Embedded",function(){Basic.extend(runtime.getShimContainer().style,{top:"0px",left:"0px",width:imgCopy.width+"px",height:imgCopy.height+"px"}),runtime=null
},999),runtime.exec.call(self,"ImageView","display",this.result.uid,width,height),imgCopy.destroy()}),tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf("base64,")+7)),type,Basic.extend({},options,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:el}))}}var imgCopy,type,quality,crop,runtime,self=this,options=arguments[1]||{},width=this.width,height=this.height;try{if(!(el=Dom.get(el)))throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);
if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT)throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);if(type=options.type||this.type||"image/jpeg",quality=options.quality||90,crop="undefined"!==Basic.typeOf(options.crop)?options.crop:!1,options.width)width=options.width,height=options.height||width;else{var dimensions=Dom.getSize(el);dimensions.w&&dimensions.h&&(width=dimensions.w,height=dimensions.h)}return imgCopy=new Image,imgCopy.bind("Resize",function(){onResize.call(self)}),imgCopy.bind("Load",function(){imgCopy.downsize(width,height,crop,!1)
}),imgCopy.clone(this,!1),imgCopy}catch(ex){this.trigger("error",ex.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var dispatches=["progress","load","error","resize","embedded"];return Image.MAX_RESIZE_WIDTH=6500,Image.MAX_RESIZE_HEIGHT=6500,Image.prototype=EventTarget.instance,Image}),define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){function Html5Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue,caps=Basic.extend({access_binary:Test(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return I.can("access_binary")&&!!extensions.Image
},display_media:Test(Env.can("create_canvas")||Env.can("use_data_uri_over32kb")),do_cors:Test(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:Test(function(){var div=document.createElement("div");return("draggable"in div||"ondragstart"in div&&"ondrop"in div)&&("IE"!==Env.browser||Env.version>9)}()),filter_by_extension:Test(function(){return"Chrome"===Env.browser&&Env.version>=28||"IE"===Env.browser&&Env.version>=10}()),return_response_headers:True,return_response_type:function(responseType){return"json"===responseType&&window.JSON?!0:Env.can("return_response_type",responseType)
},return_status_code:True,report_upload_progress:Test(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return I.can("access_binary")&&Env.can("create_canvas")},select_file:function(){return Env.can("use_fileinput")&&window.File},select_folder:function(){return I.can("select_file")&&"Chrome"===Env.browser&&Env.version>=21},select_multiple:function(){return!(!I.can("select_file")||"Safari"===Env.browser&&"Windows"===Env.os||"iOS"===Env.os&&Env.verComp(Env.osVersion,"7.0.4","<"))},send_binary_string:Test(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:Test(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||I.can("send_binary_string")
},slice_blob:Test(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return I.can("slice_blob")&&I.can("send_multipart")},summon_file_dialog:Test(function(){return"Firefox"===Env.browser&&Env.version>=4||"Opera"===Env.browser&&Env.version>=12||"IE"===Env.browser&&Env.version>=10||!!~Basic.inArray(Env.browser,["Chrome","Safari"])}()),upload_filesize:True},arguments[2]);Runtime.call(this,options,arguments[1]||type,caps),Basic.extend(this,{init:function(){this.trigger("Init")
},destroy:function(destroy){return function(){destroy.call(I),destroy=I=null}}(this.destroy)}),Basic.extend(this.getShim(),extensions)}var type="html5",extensions={};return Runtime.addConstructor(type,Html5Runtime),extensions}),define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(extensions,Blob){function HTML5Blob(){function w3cBlobSlice(blob,start,end){var blobSlice;if(!window.File.prototype.slice)return(blobSlice=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?blobSlice.call(blob,start,end):null;
try{return blob.slice(),blob.slice(start,end)}catch(e){return blob.slice(start,end-start)}}this.slice=function(){return new Blob(this.getRuntime().uid,w3cBlobSlice.apply(this,arguments))}}return extensions.Blob=HTML5Blob}),define("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(Basic){function preventDefault(){this.returnValue=!1}function stopPropagation(){this.cancelBubble=!0}var eventhash={},uid="moxie_"+Basic.guid(),addEvent=function(obj,name,callback,key){var func,events;name=name.toLowerCase(),obj.addEventListener?(func=callback,obj.addEventListener(name,func,!1)):obj.attachEvent&&(func=function(){var evt=window.event;
evt.target||(evt.target=evt.srcElement),evt.preventDefault=preventDefault,evt.stopPropagation=stopPropagation,callback(evt)},obj.attachEvent("on"+name,func)),obj[uid]||(obj[uid]=Basic.guid()),eventhash.hasOwnProperty(obj[uid])||(eventhash[obj[uid]]={}),events=eventhash[obj[uid]],events.hasOwnProperty(name)||(events[name]=[]),events[name].push({func:func,orig:callback,key:key})},removeEvent=function(obj,name,callback){var type,undef;if(name=name.toLowerCase(),obj[uid]&&eventhash[obj[uid]]&&eventhash[obj[uid]][name]){type=eventhash[obj[uid]][name];
for(var i=type.length-1;i>=0&&(type[i].orig!==callback&&type[i].key!==callback||(obj.removeEventListener?obj.removeEventListener(name,type[i].func,!1):obj.detachEvent&&obj.detachEvent("on"+name,type[i].func),type[i].orig=null,type[i].func=null,type.splice(i,1),callback===undef));i--);if(type.length||delete eventhash[obj[uid]][name],Basic.isEmptyObj(eventhash[obj[uid]])){delete eventhash[obj[uid]];try{delete obj[uid]}catch(e){obj[uid]=undef}}}},removeAllEvents=function(obj,key){obj&&obj[uid]&&Basic.each(eventhash[obj[uid]],function(events,name){removeEvent(obj,name,key)
})};return{addEvent:addEvent,removeEvent:removeEvent,removeAllEvents:removeAllEvents}}),define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _options,_files=[];Basic.extend(this,{init:function(options){var input,shimContainer,mimes,browseButton,zIndex,top,comp=this,I=comp.getRuntime();_options=options,_files=[],mimes=_options.accept.mimes||Mime.extList2mimes(_options.accept,I.can("filter_by_extension")),shimContainer=I.getShimContainer(),shimContainer.innerHTML='<input id="'+I.uid+'" type="file" style="font-size:999px;opacity:0;"'+(_options.multiple&&I.can("select_multiple")?"multiple":"")+(_options.directory&&I.can("select_folder")?"webkitdirectory directory":"")+(mimes?' accept="'+mimes.join(",")+'"':"")+" />",input=Dom.get(I.uid),Basic.extend(input.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),browseButton=Dom.get(_options.browse_button),I.can("summon_file_dialog")&&("static"===Dom.getStyle(browseButton,"position")&&(browseButton.style.position="relative"),zIndex=parseInt(Dom.getStyle(browseButton,"z-index"),10)||1,browseButton.style.zIndex=zIndex,shimContainer.style.zIndex=zIndex-1,Events.addEvent(browseButton,"click",function(e){var input=Dom.get(I.uid);
input&&!input.disabled&&input.click(),e.preventDefault()},comp.uid)),top=I.can("summon_file_dialog")?browseButton:shimContainer,Events.addEvent(top,"mouseover",function(){comp.trigger("mouseenter")},comp.uid),Events.addEvent(top,"mouseout",function(){comp.trigger("mouseleave")},comp.uid),Events.addEvent(top,"mousedown",function(){comp.trigger("mousedown")},comp.uid),Events.addEvent(Dom.get(_options.container),"mouseup",function(){comp.trigger("mouseup")},comp.uid),input.onchange=function onChange(){if(_files=[],_options.directory?Basic.each(this.files,function(file){"."!==file.name&&_files.push(file)
}):_files=[].slice.call(this.files),"IE"!==Env.browser&&"IEMobile"!==Env.browser)this.value="";else{var clone=this.cloneNode(!0);this.parentNode.replaceChild(clone,this),clone.onchange=onChange}comp.trigger("change")},comp.trigger({type:"ready",async:!0}),shimContainer=null},getFiles:function(){return _files},disable:function(state){var input,I=this.getRuntime();(input=Dom.get(I.uid))&&(input.disabled=!!state)},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid),Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid),shimContainer&&(shimContainer.innerHTML=""),shim.removeInstance(this.uid),_files=_options=shimContainer=shim=null
}})}return extensions.FileInput=FileInput}),define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(extensions,Basic,Dom,Events,Mime){function FileDrop(){function _hasFiles(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var types=Basic.toArray(e.dataTransfer.types||[]);return-1!==Basic.inArray("Files",types)||-1!==Basic.inArray("public.file-url",types)||-1!==Basic.inArray("application/x-moz-file",types)
}function _extractExts(accept){for(var exts=[],i=0;i<accept.length;i++)[].push.apply(exts,accept[i].extensions.split(/\s*,\s*/));return-1===Basic.inArray("*",exts)?exts:[]}function _isAcceptable(file){if(!_allowedExts.length)return!0;var ext=Mime.getFileExtension(file.name);return!ext||-1!==Basic.inArray(ext,_allowedExts)}function _readItems(items,cb){var entries=[];Basic.each(items,function(item){var entry=item.webkitGetAsEntry();if(entry)if(entry.isFile){var file=item.getAsFile();_isAcceptable(file)&&_files.push(file)
}else entries.push(entry)}),entries.length?_readEntries(entries,cb):cb()}function _readEntries(entries,cb){var queue=[];Basic.each(entries,function(entry){queue.push(function(cbcb){_readEntry(entry,cbcb)})}),Basic.inSeries(queue,function(){cb()})}function _readEntry(entry,cb){entry.isFile?entry.file(function(file){_isAcceptable(file)&&_files.push(file),cb()},function(){cb()}):entry.isDirectory?_readDirEntry(entry,cb):cb()}function _readDirEntry(dirEntry,cb){function getEntries(cbcb){dirReader.readEntries(function(moreEntries){moreEntries.length?([].push.apply(entries,moreEntries),getEntries(cbcb)):cbcb()
},cbcb)}var entries=[],dirReader=dirEntry.createReader();getEntries(function(){_readEntries(entries,cb)})}var _options,_files=[],_allowedExts=[];Basic.extend(this,{init:function(options){var dropZone,comp=this;_options=options,_allowedExts=_extractExts(_options.accept),dropZone=_options.container,Events.addEvent(dropZone,"dragover",function(e){_hasFiles(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="copy")},comp.uid),Events.addEvent(dropZone,"drop",function(e){_hasFiles(e)&&(e.preventDefault(),_files=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?_readItems(e.dataTransfer.items,function(){comp.trigger("drop")
}):(Basic.each(e.dataTransfer.files,function(file){_isAcceptable(file)&&_files.push(file)}),comp.trigger("drop")))},comp.uid),Events.addEvent(dropZone,"dragenter",function(){comp.trigger("dragenter")},comp.uid),Events.addEvent(dropZone,"dragleave",function(){comp.trigger("dragleave")},comp.uid)},getFiles:function(){return _files},destroy:function(){Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),_files=_allowedExts=_options=null}})}return extensions.FileDrop=FileDrop}),define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(extensions,Encode,Basic){function FileReader(){function _toBinary(str){return Encode.atob(str.substring(str.indexOf("base64,")+7))
}var _fr,_convertToBinary=!1;Basic.extend(this,{read:function(op,blob){var target=this;_fr=new window.FileReader,_fr.addEventListener("progress",function(e){target.trigger(e)}),_fr.addEventListener("load",function(e){target.trigger(e)}),_fr.addEventListener("error",function(e){target.trigger(e,_fr.error)}),_fr.addEventListener("loadend",function(){_fr=null}),"function"===Basic.typeOf(_fr[op])?(_convertToBinary=!1,_fr[op](blob.getSource())):"readAsBinaryString"===op&&(_convertToBinary=!0,_fr.readAsDataURL(blob.getSource()))
},getResult:function(){return _fr&&_fr.result?_convertToBinary?_toBinary(_fr.result):_fr.result:null},abort:function(){_fr&&_fr.abort()},destroy:function(){_fr=null}})}return extensions.FileReader=FileReader}),define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(extensions,Basic,Mime,Url,File,Blob,FormData,x,Env){function XMLHttpRequest(){function _preloadAndSend(meta,data){var blob,fr,target=this;
blob=data.getBlob().getSource(),fr=new window.FileReader,fr.onload=function(){data.append(data.getBlobName(),new Blob(null,{type:blob.type,data:fr.result})),self.send.call(target,meta,data)},fr.readAsBinaryString(blob)}function _getNativeXHR(){return!window.XMLHttpRequest||"IE"===Env.browser&&Env.version<8?function(){for(var progIDs=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],i=0;i<progIDs.length;i++)try{return new ActiveXObject(progIDs[i])}catch(ex){}}():new window.XMLHttpRequest}function _getDocument(xhr){var rXML=xhr.responseXML,rText=xhr.responseText;
return"IE"===Env.browser&&rText&&rXML&&!rXML.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(xhr.getResponseHeader("Content-Type"))&&(rXML=new window.ActiveXObject("Microsoft.XMLDOM"),rXML.async=!1,rXML.validateOnParse=!1,rXML.loadXML(rText)),rXML&&("IE"===Env.browser&&0!==rXML.parseError||!rXML.documentElement||"parsererror"===rXML.documentElement.tagName)?null:rXML}function _prepareMultipart(fd){var boundary="----moxieboundary"+(new Date).getTime(),dashdash="--",crlf="\r\n",multipart="",I=this.getRuntime();if(!I.can("send_binary_string"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);
return _xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),fd.each(function(value,name){multipart+=value instanceof Blob?dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"; filename="'+unescape(encodeURIComponent(value.name||"blob"))+'"'+crlf+"Content-Type: "+(value.type||"application/octet-stream")+crlf+crlf+value.getSource()+crlf:dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"'+crlf+crlf+unescape(encodeURIComponent(value))+crlf}),multipart+=dashdash+boundary+dashdash+crlf
}var _xhr,_filename,self=this;Basic.extend(this,{send:function(meta,data){var target=this,isGecko2_5_6="Mozilla"===Env.browser&&Env.version>=4&&Env.version<7,isAndroidBrowser="Android Browser"===Env.browser,mustSendAsBinary=!1;if(_filename=meta.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),_xhr=_getNativeXHR(),_xhr.open(meta.method,meta.url,meta.async,meta.user,meta.password),data instanceof Blob)data.isDetached()&&(mustSendAsBinary=!0),data=data.getSource();else if(data instanceof FormData){if(data.hasBlob())if(data.getBlob().isDetached())data=_prepareMultipart.call(target,data),mustSendAsBinary=!0;
else if((isGecko2_5_6||isAndroidBrowser)&&"blob"===Basic.typeOf(data.getBlob().getSource())&&window.FileReader)return void _preloadAndSend.call(target,meta,data);if(data instanceof FormData){var fd=new window.FormData;data.each(function(value,name){value instanceof Blob?fd.append(name,value.getSource()):fd.append(name,value)}),data=fd}}_xhr.upload?(meta.withCredentials&&(_xhr.withCredentials=!0),_xhr.addEventListener("load",function(e){target.trigger(e)}),_xhr.addEventListener("error",function(e){target.trigger(e)
}),_xhr.addEventListener("progress",function(e){target.trigger(e)}),_xhr.upload.addEventListener("progress",function(e){target.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):_xhr.onreadystatechange=function(){switch(_xhr.readyState){case 1:break;case 2:break;case 3:var total,loaded;try{Url.hasSameOrigin(meta.url)&&(total=_xhr.getResponseHeader("Content-Length")||0),_xhr.responseText&&(loaded=_xhr.responseText.length)}catch(ex){total=loaded=0}target.trigger({type:"progress",lengthComputable:!!total,total:parseInt(total,10),loaded:loaded});
break;case 4:_xhr.onreadystatechange=function(){},target.trigger(0===_xhr.status?"error":"load")}},Basic.isEmptyObj(meta.headers)||Basic.each(meta.headers,function(value,header){_xhr.setRequestHeader(header,value)}),""!==meta.responseType&&"responseType"in _xhr&&(_xhr.responseType="json"!==meta.responseType||Env.can("return_response_type","json")?meta.responseType:"text"),mustSendAsBinary?_xhr.sendAsBinary?_xhr.sendAsBinary(data):!function(){for(var ui8a=new Uint8Array(data.length),i=0;i<data.length;i++)ui8a[i]=255&data.charCodeAt(i);
_xhr.send(ui8a.buffer)}():_xhr.send(data),target.trigger("loadstart")},getStatus:function(){try{if(_xhr)return _xhr.status}catch(ex){}return 0},getResponse:function(responseType){var I=this.getRuntime();try{switch(responseType){case"blob":var file=new File(I.uid,_xhr.response),disposition=_xhr.getResponseHeader("Content-Disposition");if(disposition){var match=disposition.match(/filename=([\'\"'])([^\1]+)\1/);match&&(_filename=match[2])}return file.name=_filename,file.type||(file.type=Mime.getFileMime(_filename)),file;
case"json":return Env.can("return_response_type","json")?_xhr.response:200===_xhr.status&&window.JSON?JSON.parse(_xhr.responseText):null;case"document":return _getDocument(_xhr);default:return""!==_xhr.responseText?_xhr.responseText:null}}catch(ex){return null}},getAllResponseHeaders:function(){try{return _xhr.getAllResponseHeaders()}catch(ex){}return""},abort:function(){_xhr&&_xhr.abort()},destroy:function(){self=_filename=null}})}return extensions.XMLHttpRequest=XMLHttpRequest}),define("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function read(idx,size){var i,mv=II?0:-8*(size-1),sum=0;
for(i=0;size>i;i++)sum|=bin.charCodeAt(idx+i)<<Math.abs(mv+8*i);return sum}function putstr(segment,idx,length){length=3===arguments.length?length:bin.length-idx-1,bin=bin.substr(0,idx)+segment+bin.substr(length+idx)}function write(idx,num,size){var i,str="",mv=II?0:-8*(size-1);for(i=0;size>i;i++)str+=String.fromCharCode(num>>Math.abs(mv+8*i)&255);putstr(str,idx,size)}var bin,II=!1;return{II:function(order){return order===undefined?II:void(II=order)},init:function(binData){II=!1,bin=binData},SEGMENT:function(idx,length,segment){switch(arguments.length){case 1:return bin.substr(idx,bin.length-idx-1);
case 2:return bin.substr(idx,length);case 3:putstr(segment,idx,length);break;default:return bin}},BYTE:function(idx){return read(idx,1)},SHORT:function(idx){return read(idx,2)},LONG:function(idx,num){return num===undefined?read(idx,4):void write(idx,num,4)},SLONG:function(idx){var num=read(idx,4);return num>2147483647?num-4294967296:num},STRING:function(idx,size){var str="";for(size+=idx;size>idx;idx++)str+=String.fromCharCode(read(idx,1));return str}}}}),define("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(BinaryReader){return function JPEGHeaders(data){var read,idx,marker,headers=[],length=0;
if(read=new BinaryReader,read.init(data),65496===read.SHORT(0)){for(idx=2;idx<=data.length;)if(marker=read.SHORT(idx),marker>=65488&&65495>=marker)idx+=2;else{if(65498===marker||65497===marker)break;length=read.SHORT(idx+2)+2,marker>=65505&&65519>=marker&&headers.push({hex:marker,name:"APP"+(15&marker),start:idx,length:length,segment:read.SEGMENT(idx,length)}),idx+=length}return read.init(null),{headers:headers,restore:function(data){var max,i;for(read.init(data),idx=65504==read.SHORT(2)?4+read.SHORT(4):2,i=0,max=headers.length;max>i;i++)read.SEGMENT(idx,0,headers[i].segment),idx+=headers[i].length;
return data=read.SEGMENT(),read.init(null),data},strip:function(data){var headers,jpegHeaders,i;for(jpegHeaders=new JPEGHeaders(data),headers=jpegHeaders.headers,jpegHeaders.purge(),read.init(data),i=headers.length;i--;)read.SEGMENT(headers[i].start,headers[i].length,"");return data=read.SEGMENT(),read.init(null),data},get:function(name){for(var array=[],i=0,max=headers.length;max>i;i++)headers[i].name===name.toUpperCase()&&array.push(headers[i].segment);return array},set:function(name,segment){var i,ii,max,array=[];
for("string"==typeof segment?array.push(segment):array=segment,i=ii=0,max=headers.length;max>i&&(headers[i].name===name.toUpperCase()&&(headers[i].segment=array[ii],headers[i].length=array[ii].length,ii++),!(ii>=array.length));i++);},purge:function(){headers=[],read.init(null),read=null}}}}}),define("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(Basic,BinaryReader){return function(){function extractTags(IFD_offset,tags2extract){var i,ii,tag,type,count,tagOffset,offset,value,length=data.SHORT(IFD_offset),values=[],hash={};
for(i=0;length>i;i++)if(offset=tagOffset=IFD_offset+12*i+2,tag=tags2extract[data.SHORT(offset)],tag!==undefined){switch(type=data.SHORT(offset+=2),count=data.LONG(offset+=2),offset+=4,values=[],type){case 1:case 7:for(count>4&&(offset=data.LONG(offset)+offsets.tiffHeader),ii=0;count>ii;ii++)values[ii]=data.BYTE(offset+ii);break;case 2:count>4&&(offset=data.LONG(offset)+offsets.tiffHeader),hash[tag]=data.STRING(offset,count-1);continue;case 3:for(count>2&&(offset=data.LONG(offset)+offsets.tiffHeader),ii=0;count>ii;ii++)values[ii]=data.SHORT(offset+2*ii);
break;case 4:for(count>1&&(offset=data.LONG(offset)+offsets.tiffHeader),ii=0;count>ii;ii++)values[ii]=data.LONG(offset+4*ii);break;case 5:for(offset=data.LONG(offset)+offsets.tiffHeader,ii=0;count>ii;ii++)values[ii]=data.LONG(offset+4*ii)/data.LONG(offset+4*ii+4);break;case 9:for(offset=data.LONG(offset)+offsets.tiffHeader,ii=0;count>ii;ii++)values[ii]=data.SLONG(offset+4*ii);break;case 10:for(offset=data.LONG(offset)+offsets.tiffHeader,ii=0;count>ii;ii++)values[ii]=data.SLONG(offset+4*ii)/data.SLONG(offset+4*ii+4);
break;default:continue}value=1==count?values[0]:values,hash[tag]=tagDescs.hasOwnProperty(tag)&&"object"!=typeof value?tagDescs[tag][value]:value}return hash}function getIFDOffsets(){var idx=offsets.tiffHeader;return data.II(18761==data.SHORT(idx)),42!==data.SHORT(idx+=2)?!1:(offsets.IFD0=offsets.tiffHeader+data.LONG(idx+=2),Tiff=extractTags(offsets.IFD0,tags.tiff),"ExifIFDPointer"in Tiff&&(offsets.exifIFD=offsets.tiffHeader+Tiff.ExifIFDPointer,delete Tiff.ExifIFDPointer),"GPSInfoIFDPointer"in Tiff&&(offsets.gpsIFD=offsets.tiffHeader+Tiff.GPSInfoIFDPointer,delete Tiff.GPSInfoIFDPointer),!0)
}function setTag(ifd,tag,value){var offset,length,tagOffset,valueOffset=0;if("string"==typeof tag){var tmpTags=tags[ifd.toLowerCase()];for(var hex in tmpTags)if(tmpTags[hex]===tag){tag=hex;break}}offset=offsets[ifd.toLowerCase()+"IFD"],length=data.SHORT(offset);for(var i=0;length>i;i++)if(tagOffset=offset+12*i+2,data.SHORT(tagOffset)==tag){valueOffset=tagOffset+8;break}return valueOffset?(data.LONG(valueOffset,value),!0):!1}var data,tags,Tiff,tagDescs,offsets={};return data=new BinaryReader,tags={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},tagDescs={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(segment){return offsets={tiffHeader:10},segment!==undefined&&segment.length?(data.init(segment),65505===data.SHORT(0)&&"EXIF\x00"===data.STRING(4,5).toUpperCase()?getIFDOffsets():!1):!1
},TIFF:function(){return Tiff},EXIF:function(){var Exif;if(Exif=extractTags(offsets.exifIFD,tags.exif),Exif.ExifVersion&&"array"===Basic.typeOf(Exif.ExifVersion)){for(var i=0,exifVersion="";i<Exif.ExifVersion.length;i++)exifVersion+=String.fromCharCode(Exif.ExifVersion[i]);Exif.ExifVersion=exifVersion}return Exif},GPS:function(){var GPS;return GPS=extractTags(offsets.gpsIFD,tags.gps),GPS.GPSVersionID&&"array"===Basic.typeOf(GPS.GPSVersionID)&&(GPS.GPSVersionID=GPS.GPSVersionID.join(".")),GPS},setExif:function(tag,value){return"PixelXDimension"!==tag&&"PixelYDimension"!==tag?!1:setTag("exif",tag,value)
},getBinary:function(){return data.SEGMENT()},purge:function(){data.init(null),data=Tiff=null,offsets={}}}}}),define("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(Basic,x,JPEGHeaders,BinaryReader,ExifParser){function JPEG(binstr){function _getDimensions(){for(var marker,length,idx=0;idx<=_binstr.length;){if(marker=_br.SHORT(idx+=2),marker>=65472&&65475>=marker)return idx+=5,{height:_br.SHORT(idx),width:_br.SHORT(idx+=2)};
length=_br.SHORT(idx+=2),idx+=length-2}return null}function _purge(){_ep&&_hm&&_br&&(_ep.purge(),_hm.purge(),_br.init(null),_binstr=_info=_hm=_ep=_br=null)}var _binstr,_br,_hm,_ep,_info,hasExif;if(_binstr=binstr,_br=new BinaryReader,_br.init(_binstr),65496!==_br.SHORT(0))throw new x.ImageError(x.ImageError.WRONG_FORMAT);_hm=new JPEGHeaders(binstr),_ep=new ExifParser,hasExif=!!_ep.init(_hm.get("app1")[0]),_info=_getDimensions.call(this),Basic.extend(this,{type:"image/jpeg",size:_binstr.length,width:_info&&_info.width||0,height:_info&&_info.height||0,setExif:function(tag,value){return hasExif?("object"===Basic.typeOf(tag)?Basic.each(tag,function(value,tag){_ep.setExif(tag,value)
}):_ep.setExif(tag,value),void _hm.set("app1",_ep.getBinary())):!1},writeHeaders:function(){return arguments.length?_hm.restore(arguments[0]):_binstr=_hm.restore(_binstr)},stripHeaders:function(binstr){return _hm.strip(binstr)},purge:function(){_purge.call(this)}}),hasExif&&(this.meta={tiff:_ep.TIFF(),exif:_ep.EXIF(),gps:_ep.GPS()})}return JPEG}),define("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(x,Basic,BinaryReader){function PNG(binstr){function _getDimensions(){var chunk,idx;
return chunk=_getChunkAt.call(this,8),"IHDR"==chunk.type?(idx=chunk.start,{width:_br.LONG(idx),height:_br.LONG(idx+=4)}):null}function _purge(){_br&&(_br.init(null),_binstr=_info=_hm=_ep=_br=null)}function _getChunkAt(idx){var length,type,start,CRC;return length=_br.LONG(idx),type=_br.STRING(idx+=4,4),start=idx+=4,CRC=_br.LONG(idx+length),{length:length,type:type,start:start,CRC:CRC}}var _binstr,_br,_hm,_ep,_info;_binstr=binstr,_br=new BinaryReader,_br.init(_binstr),function(){var idx=0,i=0,signature=[35152,20039,3338,6666];
for(i=0;i<signature.length;i++,idx+=2)if(signature[i]!=_br.SHORT(idx))throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),_info=_getDimensions.call(this),Basic.extend(this,{type:"image/png",size:_binstr.length,width:_info.width,height:_info.height,purge:function(){_purge.call(this)}}),_purge.call(this)}return PNG}),define("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(Basic,x,JPEG,PNG){return function(binstr){var _img,_cs=[JPEG,PNG];
_img=function(){for(var i=0;i<_cs.length;i++)try{return new _cs[i](binstr)}catch(ex){}throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),Basic.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(data){return data},stripHeaders:function(data){return data},purge:function(){}}),Basic.extend(this,_img),this.purge=function(){_img.purge(),_img=null}}}),define("moxie/runtime/html5/image/MegaPixel",[],function(){function renderImageToCanvas(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight,width=options.width,height=options.height,x=options.x||0,y=options.y||0,ctx=canvas.getContext("2d");
detectSubsampling(img)&&(iw/=2,ih/=2);var d=1024,tmpCanvas=document.createElement("canvas");tmpCanvas.width=tmpCanvas.height=d;for(var tmpCtx=tmpCanvas.getContext("2d"),vertSquashRatio=detectVerticalSquash(img,iw,ih),sy=0;ih>sy;){for(var sh=sy+d>ih?ih-sy:d,sx=0;iw>sx;){var sw=sx+d>iw?iw-sx:d;tmpCtx.clearRect(0,0,d,d),tmpCtx.drawImage(img,-sx,-sy);var dx=sx*width/iw+x<<0,dw=Math.ceil(sw*width/iw),dy=sy*height/ih/vertSquashRatio+y<<0,dh=Math.ceil(sh*height/ih/vertSquashRatio);ctx.drawImage(tmpCanvas,0,0,sw,sh,dx,dy,dw,dh),sx+=d
}sy+=d}tmpCanvas=tmpCtx=null}function detectSubsampling(img){var iw=img.naturalWidth,ih=img.naturalHeight;if(iw*ih>1048576){var canvas=document.createElement("canvas");canvas.width=canvas.height=1;var ctx=canvas.getContext("2d");return ctx.drawImage(img,-iw+1,0),0===ctx.getImageData(0,0,1,1).data[3]}return!1}function detectVerticalSquash(img,iw,ih){var canvas=document.createElement("canvas");canvas.width=1,canvas.height=ih;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);for(var data=ctx.getImageData(0,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;){var alpha=data[4*(py-1)+3];
0===alpha?ey=py:sy=py,py=ey+sy>>1}canvas=null;var ratio=py/ih;return 0===ratio?1:ratio}return{isSubsampled:detectSubsampling,renderTo:renderImageToCanvas}}),define("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,x,Encode,File,ImageInfo,MegaPixel,Mime,Env){function HTML5Image(){function _getImg(){if(!_canvas&&!_img)throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);
return _canvas||_img}function _toBinary(str){return Encode.atob(str.substring(str.indexOf("base64,")+7))}function _toDataUrl(str,type){return"data:"+(type||"")+";base64,"+Encode.btoa(str)}function _preload(str){var comp=this;_img=new Image,_img.onerror=function(){_purge.call(this),comp.trigger("error",x.ImageError.WRONG_FORMAT)},_img.onload=function(){comp.trigger("load")},_img.src=/^data:[^;]*;base64,/.test(str)?str:_toDataUrl(str,_blob.type)}function _readAsDataUrl(file,callback){var fr,comp=this;return window.FileReader?(fr=new FileReader,fr.onload=function(){callback(this.result)
},fr.onerror=function(){comp.trigger("error",x.ImageError.WRONG_FORMAT)},fr.readAsDataURL(file),void 0):callback(file.getAsDataURL())}function _downsize(width,height,crop,preserveHeaders){var scale,img,destWidth,destHeight,orientation,self=this,x=0,y=0;if(_preserveHeaders=preserveHeaders,orientation=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==Basic.inArray(orientation,[5,6,7,8])){var tmp=width;width=height,height=tmp}return img=_getImg(),crop?(width=Math.min(width,img.width),height=Math.min(height,img.height),scale=Math.max(width/img.width,height/img.height)):scale=Math.min(width/img.width,height/img.height),scale>1&&!crop&&preserveHeaders?void this.trigger("Resize"):(_canvas||(_canvas=document.createElement("canvas")),destWidth=Math.round(img.width*scale),destHeight=Math.round(img.height*scale),crop?(_canvas.width=width,_canvas.height=height,destWidth>width&&(x=Math.round((destWidth-width)/2)),destHeight>height&&(y=Math.round((destHeight-height)/2))):(_canvas.width=destWidth,_canvas.height=destHeight),_preserveHeaders||_rotateToOrientaion(_canvas.width,_canvas.height,orientation),_drawToCanvas.call(this,img,_canvas,-x,-y,destWidth,destHeight),this.width=_canvas.width,this.height=_canvas.height,_modified=!0,void self.trigger("Resize"))
}function _drawToCanvas(img,canvas,x,y,w,h){if("iOS"===Env.OS)MegaPixel.renderTo(img,canvas,{width:w,height:h,x:x,y:y});else{var ctx=canvas.getContext("2d");ctx.drawImage(img,x,y,w,h)}}function _rotateToOrientaion(width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:_canvas.width=height,_canvas.height=width;break;default:_canvas.width=width,_canvas.height=height}var ctx=_canvas.getContext("2d");switch(orientation){case 2:ctx.translate(width,0),ctx.scale(-1,1);break;case 3:ctx.translate(width,height),ctx.rotate(Math.PI);
break;case 4:ctx.translate(0,height),ctx.scale(1,-1);break;case 5:ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:ctx.rotate(.5*Math.PI),ctx.translate(0,-height);break;case 7:ctx.rotate(.5*Math.PI),ctx.translate(width,-height),ctx.scale(-1,1);break;case 8:ctx.rotate(-.5*Math.PI),ctx.translate(-width,0)}}function _purge(){_imgInfo&&(_imgInfo.purge(),_imgInfo=null),_binStr=_img=_canvas=_blob=null,_modified=!1}var _img,_imgInfo,_canvas,_binStr,_blob,me=this,_modified=!1,_preserveHeaders=!0;Basic.extend(this,{loadFromBlob:function(blob){var comp=this,I=comp.getRuntime(),asBinary=arguments.length>1?arguments[1]:!0;
if(!I.can("access_binary"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);return _blob=blob,blob.isDetached()?(_binStr=blob.getSource(),void _preload.call(this,_binStr)):void _readAsDataUrl.call(this,blob.getSource(),function(dataUrl){asBinary&&(_binStr=_toBinary(dataUrl)),_preload.call(comp,dataUrl)})},loadFromImage:function(img,exact){this.meta=img.meta,_blob=new File(null,{name:img.name,size:img.size,type:img.type}),_preload.call(this,exact?_binStr=img.getAsBinaryString():img.getAsDataURL())},getInfo:function(){var info,I=this.getRuntime();
return!_imgInfo&&_binStr&&I.can("access_image_binary")&&(_imgInfo=new ImageInfo(_binStr)),info={width:_getImg().width||0,height:_getImg().height||0,type:_blob.type||Mime.getFileMime(_blob.name),size:_binStr&&_binStr.length||_blob.size||0,name:_blob.name||"",meta:_imgInfo&&_imgInfo.meta||this.meta||{}}},downsize:function(){_downsize.apply(this,arguments)},getAsCanvas:function(){return _canvas&&(_canvas.id=this.uid+"_canvas"),_canvas},getAsBlob:function(type,quality){return type!==this.type&&_downsize.call(this,this.width,this.height,!1),new File(null,{name:_blob.name||"",type:type,data:me.getAsBinaryString.call(this,type,quality)})
},getAsDataURL:function(type){var quality=arguments[1]||90;if(!_modified)return _img.src;if("image/jpeg"!==type)return _canvas.toDataURL("image/png");try{return _canvas.toDataURL("image/jpeg",quality/100)}catch(ex){return _canvas.toDataURL("image/jpeg")}},getAsBinaryString:function(type,quality){if(!_modified)return _binStr||(_binStr=_toBinary(me.getAsDataURL(type,quality))),_binStr;if("image/jpeg"!==type)_binStr=_toBinary(me.getAsDataURL(type,quality));else{var dataUrl;quality||(quality=90);try{dataUrl=_canvas.toDataURL("image/jpeg",quality/100)
}catch(ex){dataUrl=_canvas.toDataURL("image/jpeg")}_binStr=_toBinary(dataUrl),_imgInfo&&(_binStr=_imgInfo.stripHeaders(_binStr),_preserveHeaders&&(_imgInfo.meta&&_imgInfo.meta.exif&&_imgInfo.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),_binStr=_imgInfo.writeHeaders(_binStr)),_imgInfo.purge(),_imgInfo=null)}return _modified=!1,_binStr},destroy:function(){me=null,_purge.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return extensions.Image=HTML5Image}),define("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){function getShimVersion(){var version;
try{version=navigator.plugins["Shockwave Flash"],version=version.description}catch(e1){try{version=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e2){version="0.0"}}return version=version.match(/\d+/g),parseFloat(version[0]+"."+version[1])}function FlashRuntime(options){var initTimer,I=this;options=Basic.extend({swf_url:Env.swf_url},options),Runtime.call(this,options,type,{access_binary:function(value){return value&&"browser"===I.mode},access_image_binary:function(value){return value&&"browser"===I.mode
},display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===I.mode},resize_image:Runtime.capTrue,return_response_headers:!1,return_response_type:function(responseType){return"json"===responseType&&window.JSON?!0:!Basic.arrayDiff(responseType,["","text","document"])||"browser"===I.mode},return_status_code:function(code){return"browser"===I.mode||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:function(value){return value&&"browser"===I.mode
},send_browser_cookies:function(value){return value&&"browser"===I.mode},send_custom_headers:function(value){return value&&"browser"===I.mode},send_multipart:Runtime.capTrue,slice_blob:function(value){return value&&"browser"===I.mode},stream_upload:function(value){return value&&"browser"===I.mode},summon_file_dialog:!1,upload_filesize:function(size){return Basic.parseSizeStr(size)<=2097152||"client"===I.mode},use_http_method:function(methods){return!Basic.arrayDiff(methods,["GET","POST"])}},{access_binary:function(value){return value?"browser":"client"
},access_image_binary:function(value){return value?"browser":"client"},report_upload_progress:function(value){return value?"browser":"client"},return_response_type:function(responseType){return Basic.arrayDiff(responseType,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?"browser":["client","browser"]},send_binary_string:function(value){return value?"browser":"client"},send_browser_cookies:function(value){return value?"browser":"client"
},send_custom_headers:function(value){return value?"browser":"client"},stream_upload:function(value){return value?"client":"browser"},upload_filesize:function(size){return Basic.parseSizeStr(size)>=2097152?"client":"browser"}},"client"),getShimVersion()<10&&(this.mode=!1),Basic.extend(this,{getShim:function(){return Dom.get(this.uid)},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){var html,el,container;container=this.getShimContainer(),Basic.extend(container.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),html='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+options.swf_url+'" ',"IE"===Env.browser&&(html+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),html+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+options.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+Env.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===Env.browser?(el=document.createElement("div"),container.appendChild(el),el.outerHTML=html,el=container=null):container.innerHTML=html,initTimer=setTimeout(function(){I&&!I.initialized&&I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))
},5e3)},destroy:function(destroy){return function(){destroy.call(I),clearTimeout(initTimer),options=initTimer=destroy=I=null}}(this.destroy)},extensions)}var type="flash",extensions={};return Runtime.addConstructor(type,FlashRuntime),extensions}),define("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var FlashBlob={slice:function(blob,start,end,type){var self=this.getRuntime();return 0>start?start=Math.max(blob.size+start,0):start>0&&(start=Math.min(start,blob.size)),0>end?end=Math.max(blob.size+end,0):end>0&&(end=Math.min(end,blob.size)),blob=self.shimExec.call(this,"Blob","slice",start,end,type||""),blob&&(blob=new Blob(self.uid,blob)),blob
}};return extensions.Blob=FlashBlob}),define("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(extensions){var FileInput={init:function(options){this.getRuntime().shimExec.call(this,"FileInput","init",{name:options.name,accept:options.accept,multiple:options.multiple}),this.trigger("ready")}};return extensions.FileInput=FileInput}),define("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){function _formatData(data,op){switch(op){case"readAsText":return Encode.atob(data,"utf8");
case"readAsBinaryString":return Encode.atob(data);case"readAsDataURL":return data}return null}var _result="",FileReader={read:function(op,blob){var target=this,self=target.getRuntime();return"readAsDataURL"===op&&(_result="data:"+(blob.type||"")+";base64,"),target.bind("Progress",function(e,data){data&&(_result+=_formatData(data,op))}),self.shimExec.call(this,"FileReader","readAsBase64",blob.uid)},getResult:function(){return _result},destroy:function(){_result=null}};return extensions.FileReader=FileReader}),define("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){function _formatData(data,op){switch(op){case"readAsText":return Encode.atob(data,"utf8");
case"readAsBinaryString":return Encode.atob(data);case"readAsDataURL":return data}return null}var FileReaderSync={read:function(op,blob){var result,self=this.getRuntime();return(result=self.shimExec.call(this,"FileReaderSync","readAsBase64",blob.uid))?("readAsDataURL"===op&&(result="data:"+(blob.type||"")+";base64,"+result),_formatData(result,op,blob.type)):null}};return extensions.FileReaderSync=FileReaderSync}),define("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(extensions,Basic,Blob,File,FileReaderSync,FormData,Transporter){var XMLHttpRequest={send:function(meta,data){function send(){meta.transport=self.mode,self.shimExec.call(target,"XMLHttpRequest","send",meta,data)
}function appendBlob(name,blob){self.shimExec.call(target,"XMLHttpRequest","appendBlob",name,blob.uid),data=null,send()}function attachBlob(blob,cb){var tr=new Transporter;tr.bind("TransportingComplete",function(){cb(this.result)}),tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}var target=this,self=target.getRuntime();if(Basic.isEmptyObj(meta.headers)||Basic.each(meta.headers,function(value,header){self.shimExec.call(target,"XMLHttpRequest","setRequestHeader",header,value.toString())}),data instanceof FormData){var blobField;
if(data.each(function(value,name){value instanceof Blob?blobField=name:self.shimExec.call(target,"XMLHttpRequest","append",name,value)}),data.hasBlob()){var blob=data.getBlob();blob.isDetached()?attachBlob(blob,function(attachedBlob){blob.destroy(),appendBlob(blobField,attachedBlob)}):appendBlob(blobField,blob)}else data=null,send()}else data instanceof Blob?data.isDetached()?attachBlob(data,function(attachedBlob){data.destroy(),data=attachedBlob.uid,send()}):(data=data.uid,send()):send()},getResponse:function(responseType){var frs,blob,self=this.getRuntime();
if(blob=self.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(blob=new File(self.uid,blob),"blob"===responseType)return blob;try{if(frs=new FileReaderSync,~Basic.inArray(responseType,["","text"]))return frs.readAsText(blob);if("json"===responseType&&window.JSON)return JSON.parse(frs.readAsText(blob))}finally{blob.destroy()}}return null},abort:function(){var self=this.getRuntime();self.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};
return extensions.XMLHttpRequest=XMLHttpRequest}),define("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var Transporter={getAsBlob:function(type){var self=this.getRuntime(),blob=self.shimExec.call(this,"Transporter","getAsBlob",type);return blob?new Blob(self.uid,blob):null}};return extensions.Transporter=Transporter}),define("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(extensions,Basic,Transporter,Blob,FileReaderSync){var Image={loadFromBlob:function(blob){function exec(srcBlob){self.shimExec.call(comp,"Image","loadFromBlob",srcBlob.uid),comp=self=null
}var comp=this,self=comp.getRuntime();if(blob.isDetached()){var tr=new Transporter;tr.bind("TransportingComplete",function(){exec(tr.result.getSource())}),tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}else exec(blob.getSource())},loadFromImage:function(img){var self=this.getRuntime();return self.shimExec.call(this,"Image","loadFromImage",img.uid)},getAsBlob:function(type,quality){var self=this.getRuntime(),blob=self.shimExec.call(this,"Image","getAsBlob",type,quality);return blob?new Blob(self.uid,blob):null
},getAsDataURL:function(){var frs,self=this.getRuntime(),blob=self.Image.getAsBlob.apply(this,arguments);return blob?(frs=new FileReaderSync,frs.readAsDataURL(blob)):null}};return extensions.Image=Image}),define("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){function isInstalled(version){var actualVer,actualVerArray,reqVerArray,requiredVersionPart,actualVersionPart,isVersionSupported=!1,control=null,index=0;
try{try{control=new ActiveXObject("AgControl.AgControl"),control.IsVersionSupported(version)&&(isVersionSupported=!0),control=null}catch(e){var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){for(actualVer=plugin.description,"1.0.30226.2"===actualVer&&(actualVer="2.0.30226.2"),actualVerArray=actualVer.split(".");actualVerArray.length>3;)actualVerArray.pop();for(;actualVerArray.length<4;)actualVerArray.push(0);for(reqVerArray=version.split(".");reqVerArray.length>4;)reqVerArray.pop();do requiredVersionPart=parseInt(reqVerArray[index],10),actualVersionPart=parseInt(actualVerArray[index],10),index++;
while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);actualVersionPart>=requiredVersionPart&&!isNaN(requiredVersionPart)&&(isVersionSupported=!0)}}}catch(e2){isVersionSupported=!1}return isVersionSupported}function SilverlightRuntime(options){var initTimer,I=this;options=Basic.extend({xap_url:Env.xap_url},options),Runtime.call(this,options,type,{access_binary:Runtime.capTrue,access_image_binary:Runtime.capTrue,display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:!1,report_upload_progress:Runtime.capTrue,resize_image:Runtime.capTrue,return_response_headers:function(value){return value&&"client"===I.mode
},return_response_type:function(responseType){return"json"!==responseType?!0:!!window.JSON},return_status_code:function(code){return"client"===I.mode||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:Runtime.capTrue,send_browser_cookies:function(value){return value&&"browser"===I.mode},send_custom_headers:function(value){return value&&"client"===I.mode},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:Runtime.capTrue,use_http_method:function(methods){return"client"===I.mode||!Basic.arrayDiff(methods,["GET","POST"])
}},{return_response_headers:function(value){return value?"client":"browser"},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?"client":["client","browser"]},send_browser_cookies:function(value){return value?"browser":"client"},send_custom_headers:function(value){return value?"client":"browser"},use_http_method:function(methods){return Basic.arrayDiff(methods,["GET","POST"])?"client":["client","browser"]}}),isInstalled("2.0.31005.0")&&"Opera"!==Env.browser||(this.mode=!1),Basic.extend(this,{getShim:function(){return Dom.get(this.uid).content.Moxie
},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){var container;container=this.getShimContainer(),container.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+options.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+Env.global_event_dispatcher+'"/></object>',initTimer=setTimeout(function(){I&&!I.initialized&&I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))
},"Windows"!==Env.OS?1e4:5e3)},destroy:function(destroy){return function(){destroy.call(I),clearTimeout(initTimer),options=initTimer=destroy=I=null}}(this.destroy)},extensions)}var type="silverlight",extensions={};return Runtime.addConstructor(type,SilverlightRuntime),extensions}),define("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(extensions,Basic,Blob){return extensions.Blob=Basic.extend({},Blob)}),define("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(extensions){var FileInput={init:function(options){function toFilters(accept){for(var filter="",i=0;i<accept.length;i++)filter+=(""!==filter?"|":"")+accept[i].title+" | *."+accept[i].extensions.replace(/,/g,";*.");
return filter}this.getRuntime().shimExec.call(this,"FileInput","init",toFilters(options.accept),options.name,options.multiple),this.trigger("ready")}};return extensions.FileInput=FileInput}),define("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(extensions,Dom,Events){var FileDrop={init:function(){var dropZone,comp=this,self=comp.getRuntime();return dropZone=self.getShimContainer(),Events.addEvent(dropZone,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"
},comp.uid),Events.addEvent(dropZone,"dragenter",function(e){e.preventDefault();var flag=Dom.get(self.uid).dragEnter(e);flag&&e.stopPropagation()},comp.uid),Events.addEvent(dropZone,"drop",function(e){e.preventDefault();var flag=Dom.get(self.uid).dragDrop(e);flag&&e.stopPropagation()},comp.uid),self.shimExec.call(this,"FileDrop","init")}};return extensions.FileDrop=FileDrop}),define("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(extensions,Basic,FileReader){return extensions.FileReader=Basic.extend({},FileReader)
}),define("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(extensions,Basic,FileReaderSync){return extensions.FileReaderSync=Basic.extend({},FileReaderSync)}),define("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(extensions,Basic,XMLHttpRequest){return extensions.XMLHttpRequest=Basic.extend({},XMLHttpRequest)
}),define("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(extensions,Basic,Transporter){return extensions.Transporter=Basic.extend({},Transporter)}),define("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(extensions,Basic,Image){return extensions.Image=Basic.extend({},Image,{getInfo:function(){var self=this.getRuntime(),grps=["tiff","exif","gps"],info={meta:{}},rawInfo=self.shimExec.call(this,"Image","getInfo");
return rawInfo.meta&&Basic.each(grps,function(grp){var tag,i,length,value,meta=rawInfo.meta[grp];if(meta&&meta.keys)for(info.meta[grp]={},i=0,length=meta.keys.length;length>i;i++)tag=meta.keys[i],value=meta[tag],value&&(/^(\d|[1-9]\d+)$/.test(value)?value=parseInt(value,10):/^\d*\.\d+$/.test(value)&&(value=parseFloat(value)),info.meta[grp][tag]=value)}),info.width=parseInt(rawInfo.width,10),info.height=parseInt(rawInfo.height,10),info.size=parseInt(rawInfo.size,10),info.type=rawInfo.type,info.name=rawInfo.name,info
}})}),define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){function Html4Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;Runtime.call(this,options,type,{access_binary:Test(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:Test(extensions.Image&&(Env.can("create_canvas")||Env.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:Test(function(){return"Chrome"===Env.browser&&Env.version>=28||"IE"===Env.browser&&Env.version>=10
}()),resize_image:function(){return extensions.Image&&I.can("access_binary")&&Env.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(responseType){return"json"===responseType&&window.JSON?!0:!!~Basic.inArray(responseType,["text","document",""])},return_status_code:function(code){return!Basic.arrayDiff(code,[200,404])},select_file:function(){return Env.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return I.can("select_file")
},summon_file_dialog:Test(function(){return"Firefox"===Env.browser&&Env.version>=4||"Opera"===Env.browser&&Env.version>=12||!!~Basic.inArray(Env.browser,["Chrome","Safari"])}()),upload_filesize:True,use_http_method:function(methods){return!Basic.arrayDiff(methods,["GET","POST"])}}),Basic.extend(this,{init:function(){this.trigger("Init")},destroy:function(destroy){return function(){destroy.call(I),destroy=I=null}}(this.destroy)}),Basic.extend(this.getShim(),extensions)}var type="html4",extensions={};return Runtime.addConstructor(type,Html4Runtime),extensions
}),define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){function addInput(){var shimContainer,browseButton,currForm,form,input,uid,comp=this,I=comp.getRuntime();uid=Basic.guid("uid_"),shimContainer=I.getShimContainer(),_uid&&(currForm=Dom.get(_uid+"_form"),currForm&&Basic.extend(currForm.style,{top:"100%"})),form=document.createElement("form"),form.setAttribute("id",uid+"_form"),form.setAttribute("method","post"),form.setAttribute("enctype","multipart/form-data"),form.setAttribute("encoding","multipart/form-data"),Basic.extend(form.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),input=document.createElement("input"),input.setAttribute("id",uid),input.setAttribute("type","file"),input.setAttribute("name",_options.name||"Filedata"),input.setAttribute("accept",_mimes.join(",")),Basic.extend(input.style,{fontSize:"999px",opacity:0}),form.appendChild(input),shimContainer.appendChild(form),Basic.extend(input.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===Env.browser&&Env.version<10&&Basic.extend(input.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),input.onchange=function(){var file;
this.value&&(file=this.files?this.files[0]:{name:this.value},_files=[file],this.onchange=function(){},addInput.call(comp),comp.bind("change",function onChange(){var file,input=Dom.get(uid),form=Dom.get(uid+"_form");comp.unbind("change",onChange),comp.files.length&&input&&form&&(file=comp.files[0],input.setAttribute("id",file.uid),form.setAttribute("id",file.uid+"_form"),form.setAttribute("target",file.uid+"_iframe")),input=form=null},998),input=form=null,comp.trigger("change"))},I.can("summon_file_dialog")&&(browseButton=Dom.get(_options.browse_button),Events.removeEvent(browseButton,"click",comp.uid),Events.addEvent(browseButton,"click",function(e){input&&!input.disabled&&input.click(),e.preventDefault()
},comp.uid)),_uid=uid,shimContainer=currForm=browseButton=null}var _uid,_options,_files=[],_mimes=[];Basic.extend(this,{init:function(options){var shimContainer,comp=this,I=comp.getRuntime();_options=options,_mimes=options.accept.mimes||Mime.extList2mimes(options.accept,I.can("filter_by_extension")),shimContainer=I.getShimContainer(),function(){var browseButton,zIndex,top;browseButton=Dom.get(options.browse_button),I.can("summon_file_dialog")&&("static"===Dom.getStyle(browseButton,"position")&&(browseButton.style.position="relative"),zIndex=parseInt(Dom.getStyle(browseButton,"z-index"),10)||1,browseButton.style.zIndex=zIndex,shimContainer.style.zIndex=zIndex-1),top=I.can("summon_file_dialog")?browseButton:shimContainer,Events.addEvent(top,"mouseover",function(){comp.trigger("mouseenter")
},comp.uid),Events.addEvent(top,"mouseout",function(){comp.trigger("mouseleave")},comp.uid),Events.addEvent(top,"mousedown",function(){comp.trigger("mousedown")},comp.uid),Events.addEvent(Dom.get(options.container),"mouseup",function(){comp.trigger("mouseup")},comp.uid),browseButton=null}(),addInput.call(this),shimContainer=null,comp.trigger({type:"ready",async:!0})},getFiles:function(){return _files},disable:function(state){var input;(input=Dom.get(_uid))&&(input.disabled=!!state)},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();
Events.removeAllEvents(shimContainer,this.uid),Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid),shimContainer&&(shimContainer.innerHTML=""),shim.removeInstance(this.uid),_uid=_files=_mimes=_options=shimContainer=shim=null}})}return extensions.FileInput=FileInput}),define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(extensions,FileReader){return extensions.FileReader=FileReader
}),define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(extensions,Basic,Dom,Url,x,Events,Blob,FormData){function XMLHttpRequest(){function cleanup(cb){var uid,form,inputs,i,target=this,hasFile=!1;if(_iframe){if(uid=_iframe.id.replace(/_iframe$/,""),form=Dom.get(uid+"_form")){for(inputs=form.getElementsByTagName("input"),i=inputs.length;i--;)switch(inputs[i].getAttribute("type")){case"hidden":inputs[i].parentNode.removeChild(inputs[i]);
break;case"file":hasFile=!0}inputs=[],hasFile||form.parentNode.removeChild(form),form=null}setTimeout(function(){Events.removeEvent(_iframe,"load",target.uid),_iframe.parentNode&&_iframe.parentNode.removeChild(_iframe);var shimContainer=target.getRuntime().getShimContainer();shimContainer.children.length||shimContainer.parentNode.removeChild(shimContainer),shimContainer=_iframe=null,cb()},1)}}var _status,_response,_iframe;Basic.extend(this,{send:function(meta,data){function createIframe(){var container=I.getShimContainer()||document.body,temp=document.createElement("div");
temp.innerHTML='<iframe id="'+uid+'_iframe" name="'+uid+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',_iframe=temp.firstChild,container.appendChild(_iframe),Events.addEvent(_iframe,"load",function(){var el;try{el=_iframe.contentWindow.document||_iframe.contentDocument||window.frames[_iframe.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(el.title)?_status=el.title.replace(/^(\d+).*$/,"$1"):(_status=200,_response=Basic.trim(el.body.innerHTML),target.trigger({type:"progress",loaded:_response.length,total:_response.length}),blob&&target.trigger({type:"uploadprogress",loaded:blob.size||1025,total:blob.size||1025}))
}catch(ex){if(!Url.hasSameOrigin(meta.url))return void cleanup.call(target,function(){target.trigger("error")});_status=404}cleanup.call(target,function(){target.trigger("load")})},target.uid)}var uid,form,input,blob,target=this,I=target.getRuntime();if(_status=_response=null,data instanceof FormData&&data.hasBlob()){if(blob=data.getBlob(),uid=blob.uid,input=Dom.get(uid),form=Dom.get(uid+"_form"),!form)throw new x.DOMException(x.DOMException.NOT_FOUND_ERR)}else uid=Basic.guid("uid_"),form=document.createElement("form"),form.setAttribute("id",uid+"_form"),form.setAttribute("method",meta.method),form.setAttribute("enctype","multipart/form-data"),form.setAttribute("encoding","multipart/form-data"),form.setAttribute("target",uid+"_iframe"),I.getShimContainer().appendChild(form);
data instanceof FormData&&data.each(function(value,name){if(value instanceof Blob)input&&input.setAttribute("name",name);else{var hidden=document.createElement("input");Basic.extend(hidden,{type:"hidden",name:name,value:value}),input?form.insertBefore(hidden,input):form.appendChild(hidden)}}),form.setAttribute("action",meta.url),createIframe(),form.submit(),target.trigger("loadstart")},getStatus:function(){return _status},getResponse:function(responseType){if("json"===responseType&&"string"===Basic.typeOf(_response)&&window.JSON)try{return JSON.parse(_response.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))
}catch(ex){return null}return _response},abort:function(){var target=this;_iframe&&_iframe.contentWindow&&(_iframe.contentWindow.stop?_iframe.contentWindow.stop():_iframe.contentWindow.document.execCommand?_iframe.contentWindow.document.execCommand("Stop"):_iframe.src="about:blank"),cleanup.call(this,function(){target.dispatchEvent("abort")})}})}return extensions.XMLHttpRequest=XMLHttpRequest}),define("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(extensions,Image){return extensions.Image=Image
}),expose(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"])
}(this),function(exports){"use strict";var o={},inArray=exports.moxie.core.utils.Basic.inArray;return function addAlias(ns){var name,itemType;for(name in ns)itemType=typeof ns[name],"object"!==itemType||~inArray(name,["Exceptions","Env","Mime"])?"function"===itemType&&(o[name]=ns[name]):addAlias(ns[name])}(exports.moxie),o.Env=exports.moxie.core.utils.Env,o.Mime=exports.moxie.core.utils.Mime,o.Exceptions=exports.moxie.core.Exceptions,$.moxie=o,o}(window),function(window,o,undef){function normalizeCaps(settings){function resolve(feature,value,strict){var map={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};
map[feature]?caps[map[feature]]=value:strict||(caps[feature]=value)}var features=settings.required_features,caps={};return"string"==typeof features?plupload.each(features.split(/\s*,\s*/),function(feature){resolve(feature,!0)}):"object"==typeof features?plupload.each(features,function(value,feature){resolve(feature,value)}):features===!0&&(settings.chunk_size>0&&(caps.slice_blob=!0),(settings.resize.enabled||!settings.multipart)&&(caps.send_binary_string=!0),plupload.each(settings,function(value,feature){resolve(feature,!!value,!0)
})),caps}var delay=window.setTimeout,fileFilters={},plupload={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,get:function(ids){var el,els=[];"array"!==o.typeOf(ids)&&(ids=[ids]);for(var i=ids.length;i--;)el=o.get(ids[i]),el&&els.push(el);
return els.length?els:null},each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(str){var xmlEncodeChars={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},xmlEncodeRegExp=/[<>&\"\']/g;return str?(""+str).replace(xmlEncodeRegExp,function(chr){return xmlEncodeChars[chr]?"&"+xmlEncodeChars[chr]+";":chr}):str},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(name){var i,lookup;
for(lookup=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],i=0;i<lookup.length;i+=2)name=name.replace(lookup[i],lookup[i+1]);return name=name.replace(/\s+/g,"_"),name=name.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(url,items){var query="";return plupload.each(items,function(value,name){query+=(query?"&":"")+encodeURIComponent(name)+"="+encodeURIComponent(value)
}),query&&(url+=(url.indexOf("?")>0?"&":"?")+query),url},formatSize:function(size){function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision)}if(size===undef||/\D/.test(size))return plupload.translate("N/A");var boundary=Math.pow(1024,4);return size>boundary?round(size/boundary,1)+" "+plupload.translate("tb"):size>(boundary/=1024)?round(size/boundary,1)+" "+plupload.translate("gb"):size>(boundary/=1024)?round(size/boundary,1)+" "+plupload.translate("mb"):size>1024?Math.round(size/1024)+" "+plupload.translate("kb"):size+" "+plupload.translate("b")
},parseSize:o.parseSizeStr,predictRuntime:function(config,runtimes){var up,runtime;return up=new plupload.Uploader(config),runtime=o.Runtime.thatCan(up.getOption().required_features,runtimes||config.runtimes),up.destroy(),runtime},addFileFilter:function(name,cb){fileFilters[name]=cb}};plupload.addFileFilter("mime_types",function(filters,file,cb){filters.length&&!filters.regexp.test(file.name)?(this.trigger("Error",{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate("File extension error."),file:file}),cb(!1)):cb(!0)
}),plupload.addFileFilter("max_file_size",function(maxSize,file,cb){var undef;maxSize=plupload.parseSize(maxSize),file.size!==undef&&maxSize&&file.size>maxSize?(this.trigger("Error",{code:plupload.FILE_SIZE_ERROR,message:plupload.translate("File size error."),file:file}),cb(!1)):cb(!0)}),plupload.addFileFilter("prevent_duplicates",function(value,file,cb){if(value)for(var ii=this.files.length;ii--;)if(file.name===this.files[ii].name&&file.size===this.files[ii].size)return this.trigger("Error",{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate("Duplicate file error."),file:file}),void cb(!1);
cb(!0)}),plupload.Uploader=function(options){function uploadNext(){var file,i,count=0;if(this.state==plupload.STARTED){for(i=0;i<files.length;i++)file||files[i].status!=plupload.QUEUED?count++:(file=files[i],this.trigger("BeforeUpload",file)&&(file.status=plupload.UPLOADING,this.trigger("UploadFile",file)));count==files.length&&(this.state!==plupload.STOPPED&&(this.state=plupload.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",files))}}function calcFile(file){file.percent=file.size>0?Math.ceil(file.loaded/file.size*100):100,calc()
}function calc(){var i,file;for(total.reset(),i=0;i<files.length;i++)file=files[i],file.size!==undef?(total.size+=file.origSize,total.loaded+=file.loaded*file.origSize/file.size):total.size=undef,file.status==plupload.DONE?total.uploaded++:file.status==plupload.FAILED?total.failed++:total.queued++;total.size===undef?total.percent=files.length>0?Math.ceil(total.uploaded/files.length*100):0:(total.bytesPerSec=Math.ceil(total.loaded/((+new Date-startTime||1)/1e3)),total.percent=total.size>0?Math.ceil(total.loaded/total.size*100):0)
}function getRUID(){var ctrl=fileInputs[0]||fileDrops[0];return ctrl?ctrl.getRuntime().uid:!1}function runtimeCan(file,cap){if(file.ruid){var info=o.Runtime.getInfo(file.ruid);if(info)return info.can(cap)}return!1}function bindEventListeners(){this.bind("FilesAdded FilesRemoved",function(up){up.trigger("QueueChanged"),up.refresh()}),this.bind("CancelUpload",onCancelUpload),this.bind("BeforeUpload",onBeforeUpload),this.bind("UploadFile",onUploadFile),this.bind("UploadProgress",onUploadProgress),this.bind("StateChanged",onStateChanged),this.bind("QueueChanged",calc),this.bind("Error",onError),this.bind("FileUploaded",onFileUploaded),this.bind("Destroy",onDestroy)
}function initControls(settings,cb){var self=this,inited=0,queue=[],options={runtime_order:settings.runtimes,required_caps:settings.required_features,preferred_caps:preferred_caps,swf_url:$.path+"/scripts/plupload2/Moxie.swf",xap_url:$.path+"/scripts/plupload2/Moxie.xap"};plupload.each(settings.runtimes.split(/\s*,\s*/),function(runtime){settings[runtime]&&(options[runtime]=settings[runtime])}),settings.browse_button&&plupload.each(settings.browse_button,function(el){queue.push(function(cb){var fileInput=new o.FileInput(plupload.extend({},options,{accept:settings.filters.mime_types,name:settings.file_data_name,multiple:settings.multi_selection,container:settings.container,browse_button:el}));
fileInput.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can("slice_blob"),multipart:info.can("send_multipart"),multi_selection:info.can("select_multiple")}),inited++,fileInputs.push(this),cb()},fileInput.onchange=function(){self.addFile(this.files)},fileInput.bind("mouseenter mouseleave mousedown mouseup",function(e){disabled||(settings.browse_button_hover&&("mouseenter"===e.type?o.addClass(el,settings.browse_button_hover):"mouseleave"===e.type&&o.removeClass(el,settings.browse_button_hover)),settings.browse_button_active&&("mousedown"===e.type?o.addClass(el,settings.browse_button_active):"mouseup"===e.type&&o.removeClass(el,settings.browse_button_active)))
}),fileInput.bind("mousedown",function(){self.trigger("Browse")}),fileInput.bind("error runtimeerror",function(){fileInput=null,cb()}),fileInput.init()})}),settings.drop_element&&plupload.each(settings.drop_element,function(el){queue.push(function(cb){var fileDrop=new o.FileDrop(plupload.extend({},options,{drop_zone:el}));fileDrop.onready=function(){var info=o.Runtime.getInfo(this.ruid);self.features.dragdrop=info.can("drag_and_drop"),inited++,fileDrops.push(this),cb()},fileDrop.ondrop=function(){self.addFile(this.files)
},fileDrop.bind("error runtimeerror",function(){fileDrop=null,cb()}),fileDrop.init()})}),o.inSeries(queue,function(){"function"==typeof cb&&cb(inited)})}function resizeImage(blob,params,cb){var img=new o.Image;try{img.onload=function(){return params.width>this.width&&params.height>this.height&&params.quality===undef&&params.preserve_headers&&!params.crop?(this.destroy(),cb(blob)):void img.downsize(params.width,params.height,params.crop,params.preserve_headers)},img.onresize=function(){cb(this.getAsBlob(blob.type,params.quality)),this.destroy()
},img.onerror=function(){cb(blob)},img.load(blob)}catch(ex){cb(blob)}}function setOption(option,value,init){function _setOption(option,value,init){var oldValue=settings[option];switch(option){case"max_file_size":"max_file_size"===option&&(settings.max_file_size=settings.filters.max_file_size=value);break;case"chunk_size":(value=plupload.parseSize(value))&&(settings[option]=value,settings.send_file_name=!0);break;case"multipart":settings[option]=value,value||(settings.send_file_name=!0);break;case"unique_names":settings[option]=value,value&&(settings.send_file_name=!0);
break;case"filters":"array"===plupload.typeOf(value)&&(value={mime_types:value}),init?plupload.extend(settings.filters,value):settings.filters=value,value.mime_types&&(settings.filters.mime_types.regexp=function(filters){var extensionsRegExp=[];return plupload.each(filters,function(filter){plupload.each(filter.extensions.split(/,/),function(ext){extensionsRegExp.push(/^\s*\*\s*$/.test(ext)?"\\.*":"\\."+ext.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+extensionsRegExp.join("|")+")$","i")
}(settings.filters.mime_types));break;case"resize":init?plupload.extend(settings.resize,value,{enabled:!0}):settings.resize=value;break;case"prevent_duplicates":settings.prevent_duplicates=settings.filters.prevent_duplicates=!!value;break;case"browse_button":case"drop_element":value=plupload.get(value);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":settings[option]=value,init||(reinitRequired=!0);break;default:settings[option]=value}init||self.trigger("OptionChanged",option,value,oldValue)
}var self=this,reinitRequired=!1;"object"==typeof option?plupload.each(option,function(value,option){_setOption(option,value,init)}):_setOption(option,value,init),init?(settings.required_features=normalizeCaps(plupload.extend({},settings)),preferred_caps=normalizeCaps(plupload.extend({},settings,{required_features:!0}))):reinitRequired&&(self.trigger("Destroy"),initControls.call(self,settings,function(inited){inited?(self.runtime=o.Runtime.getInfo(getRUID()).type,self.trigger("Init",{runtime:self.runtime}),self.trigger("PostInit")):self.trigger("Error",{code:plupload.INIT_ERROR,message:plupload.translate("Init error.")})
}))}function onBeforeUpload(up,file){if(up.settings.unique_names){var matches=file.name.match(/\.([^.]+)$/),ext="part";matches&&(ext=matches[1]),file.target_name=file.id+"."+ext}}function onUploadFile(up,file){function handleError(){retries-->0?delay(uploadNextChunk,1e3):(file.loaded=offset,up.trigger("Error",{code:plupload.HTTP_ERROR,message:plupload.translate("HTTP Error."),file:file,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()}))}function uploadNextChunk(){var chunkBlob,formData,curChunkSize,args={};
file.status===plupload.UPLOADING&&up.state!==plupload.STOPPED&&(up.settings.send_file_name&&(args.name=file.target_name||file.name),chunkSize&&features.chunks&&blob.size>chunkSize?(curChunkSize=Math.min(chunkSize,blob.size-offset),chunkBlob=blob.slice(offset,offset+curChunkSize)):(curChunkSize=blob.size,chunkBlob=blob),chunkSize&&features.chunks&&(up.settings.send_chunk_number?(args.chunk=Math.ceil(offset/chunkSize),args.chunks=Math.ceil(blob.size/chunkSize)):(args.offset=offset,args.total=blob.size)),xhr=new o.XMLHttpRequest,xhr.upload&&(xhr.upload.onprogress=function(e){file.loaded=Math.min(file.size,offset+e.loaded),up.trigger("UploadProgress",file)
}),xhr.onload=function(){return xhr.status>=400?void handleError():(retries=up.settings.max_retries,curChunkSize<blob.size?(chunkBlob.destroy(),offset+=curChunkSize,file.loaded=Math.min(offset,blob.size),up.trigger("ChunkUploaded",file,{offset:file.loaded,total:blob.size,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()}),"Android Browser"===o.Env.browser&&up.trigger("UploadProgress",file)):file.loaded=file.size,chunkBlob=formData=null,void(!offset||offset>=blob.size?(file.size!=file.origSize&&(blob.destroy(),blob=null),up.trigger("UploadProgress",file),file.status=plupload.DONE,up.trigger("FileUploaded",file,{response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()})):delay(uploadNextChunk,1)))
},xhr.onerror=function(){handleError()},xhr.onloadend=function(){this.destroy(),xhr=null},up.settings.multipart&&features.multipart?(xhr.open("post",url,!0),plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value)}),formData=new o.FormData,plupload.each(plupload.extend(args,up.settings.multipart_params),function(value,name){formData.append(name,value)}),formData.append(up.settings.file_data_name,chunkBlob),xhr.send(formData,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url})):(url=plupload.buildUrl(up.settings.url,plupload.extend(args,up.settings.multipart_params)),xhr.open("post",url,!0),xhr.setRequestHeader("Content-Type","application/octet-stream"),plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value)
}),xhr.send(chunkBlob,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url})))}var blob,url=up.settings.url,chunkSize=up.settings.chunk_size,retries=up.settings.max_retries,features=up.features,offset=0;file.loaded&&(offset=file.loaded=chunkSize?chunkSize*Math.floor(file.loaded/chunkSize):0),blob=file.getSource(),up.settings.resize.enabled&&runtimeCan(blob,"send_binary_string")&&~o.inArray(blob.type,["image/jpeg","image/png"])?resizeImage.call(this,blob,up.settings.resize,function(resizedBlob){blob=resizedBlob,file.size=resizedBlob.size,uploadNextChunk()
}):uploadNextChunk()}function onUploadProgress(up,file){calcFile(file)}function onStateChanged(up){if(up.state==plupload.STARTED)startTime=+new Date;else if(up.state==plupload.STOPPED)for(var i=up.files.length-1;i>=0;i--)up.files[i].status==plupload.UPLOADING&&(up.files[i].status=plupload.QUEUED,calc())}function onCancelUpload(){xhr&&xhr.abort()}function onFileUploaded(up){calc(),delay(function(){uploadNext.call(up)},1)}function onError(up,err){err.code===plupload.INIT_ERROR?up.destroy():err.file&&(err.file.status=plupload.FAILED,calcFile(err.file),up.state==plupload.STARTED&&(up.trigger("CancelUpload"),delay(function(){uploadNext.call(up)
},1)))}function onDestroy(up){up.stop(),plupload.each(files,function(file){file.destroy()}),files=[],fileInputs.length&&(plupload.each(fileInputs,function(fileInput){fileInput.destroy()}),fileInputs=[]),fileDrops.length&&(plupload.each(fileDrops,function(fileDrop){fileDrop.destroy()}),fileDrops=[]),preferred_caps={},disabled=!1,startTime=xhr=null,total.reset()}var settings,startTime,total,xhr,uid=plupload.guid(),files=[],preferred_caps={},fileInputs=[],fileDrops=[],disabled=!1;settings={runtimes:o.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},setOption.call(this,options,null,!0),total=new plupload.QueueProgress,plupload.extend(this,{id:uid,uid:uid,state:plupload.STOPPED,features:{},runtime:null,files:files,settings:settings,total:total,init:function(){var self=this;
return"function"==typeof settings.preinit?settings.preinit(self):plupload.each(settings.preinit,function(func,name){self.bind(name,func)}),bindEventListeners.call(this),settings.browse_button&&settings.url?void initControls.call(this,settings,function(inited){"function"==typeof settings.init?settings.init(self):plupload.each(settings.init,function(func,name){self.bind(name,func)}),inited?(self.runtime=o.Runtime.getInfo(getRUID()).type,self.trigger("Init",{runtime:self.runtime}),self.trigger("PostInit")):self.trigger("Error",{code:plupload.INIT_ERROR,message:plupload.translate("Init error.")})
}):void this.trigger("Error",{code:plupload.INIT_ERROR,message:plupload.translate("Init error.")})},setOption:function(option,value){setOption.call(this,option,value,!this.runtime)},getOption:function(option){return option?settings[option]:settings},refresh:function(){fileInputs.length&&plupload.each(fileInputs,function(fileInput){fileInput.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=plupload.STARTED&&(this.state=plupload.STARTED,this.trigger("StateChanged"),uploadNext.call(this))
},stop:function(){this.state!=plupload.STOPPED&&(this.state=plupload.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){disabled=arguments[0]!==undef?arguments[0]:!0,fileInputs.length&&plupload.each(fileInputs,function(fileInput){fileInput.disable(disabled)}),this.trigger("DisableBrowse",disabled)},getFile:function(id){var i;for(i=files.length-1;i>=0;i--)if(files[i].id===id)return files[i]},addFile:function(file,fileName){function filterFile(file,cb){var queue=[];o.each(self.settings.filters,function(rule,name){fileFilters[name]&&queue.push(function(cb){fileFilters[name].call(self,rule,file,function(res){cb(!res)
})})}),o.inSeries(queue,cb)}function resolveFile(file){var type=o.typeOf(file);if(file instanceof o.File){if(!file.ruid&&!file.isDetached()){if(!ruid)return!1;file.ruid=ruid,file.connectRuntime(ruid)}resolveFile(new plupload.File(file))}else file instanceof o.Blob?(resolveFile(file.getSource()),file.destroy()):file instanceof plupload.File?(fileName&&(file.name=fileName),queue.push(function(cb){filterFile(file,function(err){err||(files.push(file),filesAdded.push(file),self.trigger("FileFiltered",file)),delay(cb,1)
})})):-1!==o.inArray(type,["file","blob"])?resolveFile(new o.File(null,file)):"node"===type&&"filelist"===o.typeOf(file.files)?o.each(file.files,resolveFile):"array"===type&&(fileName=null,o.each(file,resolveFile))}var ruid,self=this,queue=[],filesAdded=[];ruid=getRUID(),resolveFile(file),queue.length&&o.inSeries(queue,function(){filesAdded.length&&self.trigger("FilesAdded",filesAdded)})},removeFile:function(file){for(var id="string"==typeof file?file:file.id,i=files.length-1;i>=0;i--)if(files[i].id===id)return this.splice(i,1)[0]
},splice:function(start,length){var removed=files.splice(start===undef?0:start,length===undef?files.length:length),restartRequired=!1;return this.state==plupload.STARTED&&(plupload.each(removed,function(file){return file.status===plupload.UPLOADING?(restartRequired=!0,!1):void 0}),restartRequired&&this.stop()),this.trigger("FilesRemoved",removed),plupload.each(removed,function(file){file.destroy()}),restartRequired&&this.start(),removed},bind:function(name,func,scope){var self=this;plupload.Uploader.prototype.bind.call(this,name,function(){var args=[].slice.call(arguments);
return args.splice(0,1,self),func.apply(this,args)},0,scope)},destroy:function(){this.trigger("Destroy"),settings=total=null,this.unbindAll()}})},plupload.Uploader.prototype=o.EventTarget.instance,plupload.File=function(){function PluploadFile(file){plupload.extend(this,{id:plupload.guid(),name:file.name||file.fileName,type:file.type||"",size:file.size||file.fileSize,origSize:file.size||file.fileSize,loaded:0,percent:0,status:plupload.QUEUED,lastModifiedDate:file.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var file=this.getSource().getSource();
return-1!==o.inArray(o.typeOf(file),["blob","file"])?file:null},getSource:function(){return filepool[this.id]?filepool[this.id]:null},destroy:function(){var src=this.getSource();src&&(src.destroy(),delete filepool[this.id])}}),filepool[this.id]=file}var filepool={};return PluploadFile}(),plupload.QueueProgress=function(){var self=this;self.size=0,self.loaded=0,self.uploaded=0,self.failed=0,self.queued=0,self.percent=0,self.bytesPerSec=0,self.reset=function(){self.size=self.loaded=self.uploaded=self.failed=self.queued=self.percent=self.bytesPerSec=0
}},$.plupload2=plupload}(window,$.moxie)};exports(),module.resolveWith(exports)};FD40.module("plupload2",moduleFactory)}();